!function(){"use strict";function e(){this.create=function(e,t){return this.ioLink=io.connect(e,t),this},this.close=function(){this.ioLink.disconnect()},this.emitMsg=function(e,t,i,n){return this.ioLink.compress(!1).emit(e,t),i&&i.call(n),this},this.receiveMsg=function(e,t,i,n,a){var i=i||this;return a?this.ioLink.once(e,function(e){n&&$.extend(e,n),t&&t.call(i,e)}):this.ioLink.on(e,function(e){n&&$.extend(e,n),t&&t.call(i,e)}),this}}function t(){"chat"!=window.__domain.chat&&window.console&&window.console.trace&&"[object Function]"==Object.prototype.toString.apply(window.console.trace)&&window.console.trace(arguments)}function i(){var e=navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(e)?"Windows Phone":/android/i.test(e)?"Android":/iPad|iPhone|iPod/.test(e)&&!window.MSStream?"iOS":"unknown"}function n(){"iOS"==Pe?Ie.chatListWrap[0].scrollTop=Ie.chatListWrap[0].scrollHeight-Ie.chatListWrap.height():Ie.chatListWrap.children().last()[0].scrollIntoView(!1)}function a(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i)}function o(e){var t=100,i=e,n=i-t+1;return Math.floor(Math.random()*n+t)}function r(e){var t,i=!0,a=e.msgType,o={seq:e.seq};switch(a){case"tmpl":t=$.tmpl(we.CHAT_MSG_TPL[e.type],e.data);break;case"serverResp":t=e.data;break;default:t=we.SYS_MSG[e.type]}$.extend(o,{msg:t}),"sessionEnd"==e.type&&(Ee.isChangeKF?i=!1:Ee.ioLinkStatus="sessionOver"),e.empty&&Ie.chatBody.hasClass("regsuccess")&&(e.empty=!1),i&&!e.notip&&(e.empty?Ie.chatListWrap.empty().append(qe(we.CHAT_MSG_TPL.sys,o)):Ie.chatBody.hasClass("regsuccess")&&"new"==e.act?Ie.chatListWrap.append(qe(we.CHAT_MSG_TPL.sys,o)):"update"==e.act?Ie.chatBody.hasClass("regsuccess")?$('[data-guid="'+e.seq+'"]').find(".text").html(o.msg):Ie.chatListWrap.find(".msg-sys").last().find(".text").html(o.msg):"remove"==e.act&&$('[data-guid="'+e.seq+'"]').remove(),n())}function s(e,t,i,n,a){a&&(a=new Date(+new Date+a));var o=e+"="+escape(t)+(a?"; expires="+a.toGMTString():"")+(n?"; path="+n:"")+(i?"; domain="+i:"");return o.length<4096&&(Ae.cookie=o),this}function c(e){var t=Ae.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return null!=t?unescape(t[2]):null}function l(){var e=c("uin");return e?Math.floor(e.substring(1)):""}function d(e,t,i){var n,a="kf"+e,o=JSON.parse(Ge.get(a));return o&&o.forEach(function(e){e.visitorId==t&&(n=e.total,"set"==i&&(n++,e.total=n))}),"get"==i?n:void Ge.set("kf"+e,JSON.stringify(o))}function u(){var e=arguments.length<=0||void 0===arguments[0]?"add":arguments[0],t=arguments.length<=1||void 0===arguments[1]?"qq":arguments[1],i=Ie.header.find("span.title"),n=Ee.isMobile?"H5":"PC";"add"==e?"qq"==t&&0==Ie.callGroup.find(".btn-callqq").length?Ie.callGroup.append(we.HEADER_TPL[n].BTN_CALL_QQ):"tel"==t&&0==Ie.callGroup.find(".btn-calltel").length&&Ie.callGroup.append(we.HEADER_TPL[n].BTN_CALL_TEL):"remove"==e&&("qq"==t?Ie.callGroup.find(".btn-callqq").remove():"tel"==t&&Ie.callGroup.find(".btn-calltel").remove()),2==Ie.callGroup.children().length?i.addClass("title-mini"):i.removeClass("title-mini")}function p(e,t,i){var n=this,a=$($.tmpl(we.CHAT_MSG_TPL.blackTip,e));Ie.chatList.append(a),setTimeout(function(){a.remove(),i&&i.apply(n)},t)}function f(e){var t=$.extend(!0,{},Ee.getSigTData),i=Ee.receptionist.extUin,n=e.type;window.bindCallQQEvent=function(e){var t,i=1e3;return Ee.inRegProcess=0,e&&0==e.r&&"undefined"!=typeof e.data.sign?(t=e.data.sign,void We(t)):void p({text:"点击失败："+e.data.message},i)},"qq"==n&&($.extend(t,{roleValue:0,reqPos:e.reqPos,reqSrc:"routeChange"}),e.data?$.extend(t,e.data):$.extend(t,{roleData:i,clickid:be()}),K(t,we.CGI_URL.GET_TENCENT_SCHEME,"bindCallQQEvent"))}function g(e){var t=arguments.length<=1||void 0===arguments[1]?{type:"qq"}:arguments[1];$.extend(t,{reqPos:e.attr("reqpos")}),e.off(Ee.clickName).on(Ee.clickName,$.proxy(f,null,t))}function m(e,t){return"c2b"==e?-1!=t.indexOf("f_")?t:t.replace(/\[(.*?)\]/g,function(e,t){for(var i=0;i<Je.humen.length;i++)if(Je.humen[i]==t)return"[f_"+Je.index[i]+"]";return e}):"b2c"==e?t:void 0}function h(e){for(var t=e.seq,i=0;i<Ve.length;i++)Ve[i].seq==t&&(Ve.splice(i,1),Ee.c2bSeqGroup=Ve,lt.normal.sendFail([e]))}function v(e,t,i,n,a,o){var r,s,c,l=Ee.chatSocket,d=Ee.wpaDetail,p=Ee.ioLinkStatus;l.ioLink&&l.ioLink.disconnected&&"sessionOver"!=p&&(p="over",Ee.ioLinkStatus="over",Ke.remove()),1==t.type&&("undefined"!=typeof t.originMsgContent&&(t.data=t.originMsgContent,delete t.originMsgContent),t.data=m(e,t.data)),"welcome"!=i&&("c2b"==e?(s=t.date,$.extend(t,{clickid:d.clickid,date:s}),"over"==p?(r=t,BJ_REPORT.info("IoLink Over ReConnect"),gt().reConnect(!1)):"sessionOver"==p?(r=t,BJ_REPORT.info("Session Over ReConnect"),gt().reConnect()):"normal"==p&&(c={seq:t.seq,data:t.data,type:t.type},Ee.isChangeKF&&(l.emitMsg(we.SOCKET_CMD.KF_CHANGE.EMIT,{kf:""}),Ie.chatListWrap.find(".btn-newkf").addClass("disabled"),u(),g(Ie.callGroup.find(".btn-callqq"),{type:"qq"})),2==t.type?$.extend(c,{imgSrc:t.imgSrc}):"",Ee.c2bDBsaveData.push(c),Ve.push({sendTime:s,seq:t.seq,type:t.type}),Ee.c2bSeqGroup=Ve,setTimeout(function(){h(t)},we.SOCKET_OPTS.C2B_TIMEOUT),r=null,Ke.update(),l.emitMsg(we.SOCKET_CMD.C2B.EMIT,t)),Ee.reSendC2bMsg=r,4739345==t.data&&(Ge.clear(),Ee.win.location.reload())):"b2c"==e&&("msg"===i&&Ke.update(),a&&Ee.chatSocket.emitMsg(we.SOCKET_CMD.B2C.EMIT,{date:t.date,seq:t.seq,sortseq:t.sortseq-Ee.serverClientTimeDiff,csrf:t.csrf}),a&&("undefined"==typeof t.csrf||!t.csrf)&&BJ_REPORT.report("B2C Ack Csrf Error "+JSON.stringify(t)),o&&Be.saveMsg(e,t,n)))}function S(e,t){for(var i=arguments.length<=2||void 0===arguments[2]?"prepend":arguments[2],n=e.toString().length;t>n;)e="prepend"==i?"0"+e:e+"0",n++;return e}function y(e){var e=new Date(e),t=S(e.getMonth()+1,2),i=S(e.getDate(),2),n=S(e.getHours(),2),a=S(e.getMinutes(),2);return t+"-"+i+"&nbsp;"+n+":"+a}function T(e){var t=arguments.length<=1||void 0===arguments[1]?"append":arguments[1];Me?e-Me>we.VIEW_OPTS.TIME_INTERVAL&&(Me=e,Ie.chatListWrap[t](qe(we.CHAT_MSG_TPL.time,y(Me)))):(Me=e,Ie.chatListWrap[t](qe(we.CHAT_MSG_TPL.time,y(Me))))}function b(e){window.open(e,"_blank")}function _(e){var t;Ie.chatBody.append('<div class="mod-fullscreen"><div class="overlay"></div></div>'),t=$(".mod-fullscreen"),Ee.isMobile&&t.on("touchmove",function(e){return e.preventDefault(),!1}),e&&e(t)}function w(e){for(var t,i=Ge.get(Ee.seqs.key),n=$e.getType(e),a=$e.getBody(e),o=new RegExp(a,"gm"),r=!0;null!=(t=o.exec(i));)if(n==i.substr(t.index+13,1))return BJ_REPORT.report("Duplicate Msg SingleSeqs "+e),tt(JSON.stringify(Ee.seqs.data)),!1;return r}function E(e){for(var t,i=Ee.seqs.data,n=($e.getType(e),$e.getBody(e)),a=i.length,o=0;a>o;o++)if(t=i[o],n<$e.getBody(t))return{act:"insert",insertSeqs:t,singleSeqs:e,index:o};return{act:"append",singleSeqs:e}}function C(){function e(){i=!1,r?document.dispatchEvent(n):document.documentElement.visibilitychange=1}function t(){i=!0,r?document.dispatchEvent(n):document.documentElement.visibilitychange=0}var i=void 0,n=null,a=function(e){var t=document.createElement("b");return t.innerHTML="<!--[if IE "+e+"]><i></i><![endif]-->",1===t.getElementsByTagName("i").length},o=a(),r=a(9),s=r?"":null,c=function(e,t){return""!==e?e+t.slice(0,1).toUpperCase()+t.slice(1):t},l=function(){var e=!1;return"number"==typeof window.screenX&&["webkit","moz","ms","o",""].forEach(function(t){0==e&&void 0!=document[c(t,"hidden")]&&(s=t,e=!0)}),e}();o&&!l&&(document.addEventListener?(window.addEventListener("focus",e,!0),window.addEventListener("blur",t,!0)):(document.attachEvent("onfocusin",e),document.attachEvent("onfocusout",t)),"undefined"==typeof document.createEvent||n?document.documentElement.visibilitychange=0:(n=document.createEvent("HTMLEvents"),n.initEvent("visibilitychange",!0,!0)));var d=function(){return l?document[c(s,"hidden")]:"undefined"!=typeof i?i:void 0},u=function(){return l?document[c(s,"visibilityState")]:"undefined"!=typeof i?i?"hidden":"visible":void 0};return{hidden:d(),isHidden:d,isPageVisibilitySupport:l,visibilityState:u(),visibilitychange:function(e,t){if(t=!1,"function"==typeof e){if(l||r)return document.addEventListener(s+"visibilitychange",function(t){e.call(this,t,d(),u())},t);document.documentElement.attachEvent("onpropertychange",function(t){"visibilitychange"==event.propertyName&&e.call(this,t,d(),u())})}}}}function I(e,t){var i=new Image,n=$(window),a=0,o={width:1,height:1},r={width:0,height:0},s={width:n.innerWidth()-160,height:n.innerHeight()},c={width:0,height:0};i.onload=function(){return r={width:i.width,height:i.height},a=Math.max(r.width,r.height),o={width:r.width/r.height,height:r.height/r.width},r.width<=s.width&&r.height<=s.height?c={width:r.width,height:r.height}:r.width==a?(c.width=s.width,c.height=Math.floor(c.width*o.height)):(c.height=s.height,c.width=Math.floor(c.height*o.width)),e.find("img").attr({width:c.width,height:c.height,src:t}).css({"margin-top":0-c.height/2,"margin-left":0-c.width/2}),c},i.src=t}function O(e,t){var i=t.code;switch(0!==i&&BJ_REPORT.report("Image Upload Error "+JSON.stringify(t)),i){case 0:v("c2b",{data:t.fileId,seq:e.seq,wordMsgSeq:o(we.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PC),date:e.date,type:2,imgSrc:t.uri},"msg"),t._raw&&(e.blobUrl=t.uri,replacePlaceholder(e));break;case 1:q().sendFail(e,"overSumLimit");break;case 2:q().sendFail(e,"notSupport");break;default:q().sendFail(e,"uploadError")}}function k(e){return e.replace(Xe,function(e){return'<a href="'+Ze(e)+'" target="_blank" class="text-link">'+e+"</a>"})}function R(e,t,i){function n(e){De.send({act:"OPEN_IMG",data:{url:e}})}var a,o,r=e.is("img")?e:e.find("p.image");Ee.isMobile?r.off("tap").on("tap",function(){_(function(e){e.append('<img class="big-image" src="'+t+'"/>'),e.on("touchend",function(t){e.remove()})})}):($("body").delegate(r,"click",function(e){"INPUT"!=e.target.nodeName&&e.preventDefault()}),r.off("click").on("click",function(e){Ee.isInIframe?i?(a=new FileReader,a.onload=function(e){n(e.target.result)},a.readAsDataURL(i.content)):n(t):(o=t?t:i.blobUrl,_(function(e){e.append('<div class="img-wrap"><img class="" src=""/><a href="javascript:;" class="btn-close"></a></div>'),I(e,o),e.on("click","a.btn-close",function(t){t.preventDefault(),e.remove()})}))}))}function M(e,t,i){var a=e.getAttribute("src"),o=a.replace(/\/720$/g,"/0"),r=$(e).parent();e.onload=function(){$(this).parent().css("background-image","none"),e.getAttribute("src")!==Ee.imageLoadFail&&R($(this),o),t&&n()},"session"==i&&(e.onerror=function(t){this.setAttribute("src",Ee.imageLoadFail),r.find("i").remove(),r.on(Ee.clickName,function(){e.setAttribute("src",a),r.append('<i class="loading loading-s"></i>')}),BJ_REPORT.report("B2C Image Load Error Src "+a)})}function P(e,t){var i,e="undefined"!=typeof Ee.win.emoji?Ee.win.emoji.replace_unified(e):e,n=Ee.isMobile?we.CGI_URL.QQ_FACE:we.CGI_URL.COMP_SOURCE_URL+"img/qq/";return e.replace(/\[(.*?)\]/g,function(e,a){if(0==a.indexOf("f")){a=a.match(/\d+/g);for(var o=0;o<Je.index.length;o++)if(Je.index[o]==a){i=o;break}}else if("b2c"!=t)for(var o=0;o<Je.humen.length;o++)if(Je.humen[o]==a){i=o;break}return i||0===i?'<img src="'+n+i+'.png" class="face"/>':e})}function L(e){var t;Ee.isRealSendMsg&&Ee.win.FormData&&(t=new FormData,t.append("media",e.content),t.append("visitId",Ee.receptionist.visitorId),t.append("receptionUin",Ee.receptionist.extUin),$.ajax({url:we.CGI_URL.UPLOAD_IMG,data:t,processData:!1,contentType:!1,type:"POST",timeout:5e4,error:function(){q().sendFail(e,"uploadError")},success:function(t){O(e,t)}}))}function D(){function e(e){var t="kf"+Ee.receptionist.kfUin,o=JSON.parse(Ge.get(t));0==a.isLoad&&(a.isLoad=1,o&&o.forEach(function(e){e.visitorId==Ee.receptionist.visitorId&&(a.sum=e.total)}),a.sum>0&&(i(e),1!=a.pageNum||e?"":n()))}function t(e,t){var i,n=e.dir,a=parseInt($.trim(e.type)),t=t||"down";switch(a){case 1:e.data=k(xe(e.data)),i=$(P(qe(we.CHAT_MSG_TPL[n],e),n));break;case 2:n="c2b"==n?"c2bImage":"b2cImage",i=$(qe(we.CHAT_MSG_TPL[n],e)),M(i.find("p.image img")[0]);break;case 3:$.extend(e.data,{currentVersion:Ee.menuDetail.currentVersion}),e.data.config||$.extend(!0,e.data,{config:{menu:0,button:0}}),i=$($.tmpl(we.CHAT_MSG_TPL.menuMsgNormal,e.data)),Ye().bindEvents(i);break;case 4:ot.render(e,e.dir,{isNeedStore:!1,isNeedWrap:!0,isFromHistory:!0});break;case 5:i=rt.render(e,{isFromHistory:!0});break;default:BJ_REPORT.report("History Msg Render Error Type "+a)}i&&Ie.chatListWrap["down"==t?"append":"prepend"](i).trigger("graphicMsgLoad",e),/Image/g.test(n)&&R(i,e.data.replace(/\/720$/g,"/0"))}function i(e){var n,r,s,c,l=Ee.receptionist.kfUin,d=Ee.receptionist.visitorId,u=we.VIEW_OPTS.HISTORY_MSG.PER_NUM,p=Ee.seqs.data;s=a.sum-u,0>s&&(s=0);for(var f=a.sum;f>s;f--)n="kf"+l+"vId"+d+"index"+p[f-1],r=JSON.parse(Ge.get(n)),r?(t(r,"up"),r.time&&4!=r.type&&Ie.chatListWrap.prepend(qe(we.CHAT_MSG_TPL.time,y(r.time)))):BJ_REPORT.report("History RenderAll Msg Error"),a.sum--;0==a.pageNum?o=Ie.chatListWrap[0].scrollHeight+60:setTimeout(function(){o=Ie.chatListWrap[0].scrollHeight-o,Ie.chatListWrap[0].scrollTop=o,o=Ie.chatListWrap[0].scrollHeight},20),a.pageNum++,a.sum<=0?a.pageNum=1:(c=$(qe(we.CHAT_MSG_TPL.msgLoad.getMsg,we.VIEW_OPTS.HISTORY_MSG.GET_MSG)),Ie.chatListWrap.prepend(c),c.find("a").one(Ee.clickName,function(){o=e?Ie.chatListWrap[0].scrollHeight:o,c.html(qe(we.CHAT_MSG_TPL.msgLoad.loading,we.VIEW_OPTS.HISTORY_MSG.LOADING)),setTimeout(function(){c.remove(),i()},200)}))}var a={sum:0,pageNum:0,isLoad:0},o=0;return{start:e,renderSigle:t}}function x(){function e(e,i){var a,o,r=arguments.length<=2||void 0===arguments[2]?"msg":arguments[2],s=arguments[3],c=arguments[4],l=arguments.length<=5||void 0===arguments[5]?"true":arguments[5],d=arguments.length<=6||void 0===arguments[6]?"true":arguments[6],u=Ie.chatListWrap[0],p=s,f=c||{act:"append"},g=Ee.isRealSendMsg;~e.indexOf("b2c")&&u.scrollHeight-u.scrollTop==u.getBoundingClientRect().height&&(p=!0),a=t(e,i,p),a&&("insert"==f.act?(o=$('[data-guid="'+JSON.parse(Ge.get("kf"+Ee.receptionist.kfUin+"vId"+Ee.receptionist.visitorId+"index"+f.insertSeqs)).seq+'"]'),a.insertBefore(o)):"prepend"==f.act?(Ie.chatListWrap[f.act](a),T(i.date,f.act)):(T(i.date,f.act),Ie.chatListWrap[f.act](a)),Ie.chatListWrap.trigger("graphicMsgLoad",[i]),"c2b"!=e&&"c2bImage"!=e||"msg"!=r||!g||$('[data-guid="'+i.seq+'"]').find("i").addClass("loading loading-s"),("open"==Ee.imStatus&&"c2b"==e||p)&&n(),"c2bImage"!=r&&g&&v(e,i,r,f,l,d))}function t(e,t,i){var n="c2b"==e?new RegExp(/\n/g):new RegExp(/\r/g),a=t.data;if(("undefined"==typeof t.avatar||0==t.avatar.length)&&(t.avatar=Ee.defaultAvatar),1==t.type&&(t.originMsgContent=a,t.data=k(xe(a))),"b2c"==e&&2==t.type){var o=$(qe(we.CHAT_MSG_TPL.b2cImage,t));return M(o.find("p.image img")[0],i,"session"),o}return 4==t.type?$.tmpl(t.data.tpl,t.data):5==t.type?rt.render(t,{isFromHistory:!1}):$(P(qe(we.CHAT_MSG_TPL[e],t).replace(n,"<br/>")))}function i(e){for(var t=0,i=e.length;i>t;t++){var n=e[t],a=n.seq,o=(n.data,$('[data-guid="'+a+'"]').find("i"));o.removeAttr("class").addClass("icon-fail"),o.data("reSendData",n),BJ_REPORT.report("C2B Msg Fail Seqs "+n.date+n.type),o.off(Ee.clickName),o.one(Ee.clickName,function(){var e=$(this).data("reSendData");Ee.reSendC2bMsg=e,$(this).removeClass("icon-fail").addClass("loading loading-s"),v("c2b",e,"msg")})}}function a(e){var t,n=e.body.seq,a=$('[data-guid="'+n+'"]').find(".loading"),o=(a.parent(),Ee.c2bSeqGroup),r=e.body.seq,s=0;if("success"==e.result&&n){a.remove();for(var c=0;c<o.length;c++)if(r==o[c].seq){s=o[c].sendTime,t=$e.setType(s,o[c].type),w(t)&&Be.saveMsg("c2b",{seq:n,type:o[c].type,date:s||e.body.date,singleSeqs:t});break}Ee.isChangeKF=0;for(var c=0;c<o.length;c++){o[c].seq==n&&(o.splice(c,1),Ee.c2bSeqGroup=o);break}}else i([{data:e.body.data,seq:e.body.seq,wordMsgSeq:e.body.wordMsgSeq}])}function o(t){var i=parseInt(t.body.sortseq)+Ee.serverClientTimeDiff,n=$e.setType(i,t.body.type),a={face:Ee.receptionist.avatar,name:Ee.receptionist.name},o=w(n),s={};t.body.u_info.face&&$.extend(a,t.body.u_info),t.body.u_info.name&&$.extend(a,t.body.u_info),!o&&Ee.chatSocket.emitMsg(we.SOCKET_CMD.B2C.EMIT,{date:t.body.date,seq:t.body.seq,sortseq:t.body.sortseq,csrf:t.body.csrf}),t.body.sortseq&&o?(s=E(n),e("b2c",{avatar:a.face,name:a.name,data:t.body.data,date:t.body.date,seq:t.body.seq,type:t.body.type,csrf:t.body.csrf,sortseq:i},"msg",null,s),ct.isHidden()&&r.twinkling(),ct.visibilitychange(function(e,t,i){0==t&&"visible"==i&&r.clearTimer()}),"close"==Ee.imStatus&&et.set(Ee.receptionist,Ee.wpaDetail.wpaId,function(e){De.send({act:"UNREAD",data:{number:e,onlyOpen:!0}})})):t.body.sortseq||BJ_REPORT.report("B2C Sortseq Null "+JSON.stringify(t))}var r=new st({dynamicTitle:!0,interval:1e3});return{render:e,conventSigle:t,sendFail:i,sendRet:a,renderB2C:o}}function q(){function e(e,t){var n=e;$.extend(n,{date:+new Date}),x().render("c2bImage",{seq:e.seq,date:e.date},"msg"),t&&i(e,t)}function t(e){var t=e.seq,n=$('[data-guid="'+t+'"]').find("img");e.blobUrl?(n.attr("src",e.blobUrl),R(n,e.blobUrl),M(n[0],!0),e.size>we.IMG_UPLOAD_OPTS.MAX_SIZE?i(e,"overSumLimit"):L(e)):e.DataURL&&(n.attr("src",e.DataURL),M(n[0],!0),e.size>we.IMG_UPLOAD_OPTS.MAX_SIZE&&i(e,"overSumLimit"))}function i(e,t){var i=e.seq,a=$('[data-guid="'+i+'"]'),o=a.find("i");BJ_REPORT.report("Image Msg Send Error Reason "+t),o.removeClass("loading loading-s").addClass("icon-fail").data("reason",t),"uploadError"==t?o.off(Ee.clickName).on(Ee.clickName,function(){$(this).removeClass("icon-fail").addClass("loading loading-s"),L(e)}):a.find("p.image").addClass(t),n()}return{render:e,replacePlaceholder:t,sendFail:i}}function A(e){var t={welcome:!1,offline:!1};return e.body.o_u_info||!e.body.u_info.welcome||e.body.nowelcome||(t.welcome=!0,lt.normal.render("b2c",{avatar:Ee.receptionist.avatar,name:e.body.u_info.name,data:e.body.u_info.welcome,date:e.body.date,seq:e.body.seq,type:1},"welcome")),e.body.offlineMsgNum>0&&(t.offline=!0,t.welcome?dt.render.load(e,e.body.seq):dt.render.load(e)),t}function N(e){var t=e.body.c_info.name,i={},n=Ee.isMobile?Ie.header.find("span.title"):Ie.header.find("span.name");r({type:"regSuccess",act:"update",seq:Ee.inRegProcess}),Ee.inRegProcess=0,!Ie.chatBtnSend.hasClass("enabled")&&Ie.chatBtnSend.addClass("enabled"),Ie.chatBody.hasClass("regsuccess")||(document.title=Ee.isMobile?t:"与"+t+"交谈中",Ie.chatListWrap.empty(),n.text(t),Ie.chatBody.addClass("regsuccess"),Ie.chatListWrap.removeClass("chat-initial"),Ie.chatBtnSend.addClass("enabled"),Ie.btnUpload.addClass("enabled")),i=A(e),lt.historyMsg.start(i.offline),e.body.u_info.type?"guide"!=e.body.u_info.type||e.body.o_u_info||(Ee.menuDetail.active=1,u("remove","qq"),Ye().render.start(e.body.u_info)):(Ee.menuDetail.active=0,Ee.isRealSendMsg=1,u(),g(Ie.callGroup.find(".btn-callqq"),{type:"qq"}))}function G(e){var t=e.body.data,i=e.body.offline||0,a=Ee.receptionist,o=Ee.wpaDetail,r=Ee.chatSocket,s=Ee.imStatus;return 1==t&&Ee.isMobile?void(t="tel"):(2==t&&(t="qq"),i&&Ie.chatListWrap.append(qe(we.CHAT_MSG_TPL.sys,we.SYS_MSG["call"+t])),Ie.chatListWrap.append(qe(we.CHAT_MSG_TPL["call"+t],a)),g(Ie.chatListWrap.find(".btn-act"),{type:t}),n(),r.emitMsg(we.SOCKET_CMD.ROUTE.EMIT,{csrf:e.body.csrf,seq:e.body.seq}),void("close"==s&&et.set(a,o.wpaId,function(e){De.send({act:"UNREAD",data:{number:e}})},!1)))}function U(e){var t=e.data,i=(Ee.receptionist,Ee.chatSocket);if(i.emitMsg(we.SOCKET_CMD.SESSION_MSG.EMIT,{csrf:e.csrf,seq:e.seq,type:e.type,time:e.time}),$.extend(Ee.receptionist,{extUin:t.uin,name:t.name,avatar:t.face||Ee.defaultAvatar,resign:t.position}),r({type:"b2cKfChange",msgType:"tmpl",act:"new",data:{name:Ee.receptionist.name}}),"undefined"!=typeof t.welcome&&t.welcome){var n=+new Date+Ee.serverClientTimeDiff;lt.normal.render("b2c",{avatar:Ee.receptionist.avatar,name:Ee.receptionist.name,data:t.welcome,seq:o(we.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),type:1,wordMsgSeq:o(we.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PC),date:n,sortseq:n},"welcome",!0,{act:"append",singleSeqs:n+"1"},!1,!1)}}function B(e){var t=e.body,i=t.type||"unknown";switch(i){case 1000010:U(t);break;case 1000011:ut().initialize(t);break;case 1000012:ot.render(t,"b2c",{isNeedStore:!1,isNeedAck:!0,isNeedWrap:!1});break;case 1000013:$.extend(t.data,{name:Ee.receptionist.name,face:Ee.receptionist.avatar,extUin:Ee.receptionist.extUin}),ot.render(t,"b2c",{msgName:"addfriend",isNeedStore:!0,isNeedAck:!0,isNeedWrap:!0});break;case 1000014:at.renderRet({ret:"success",kfAccount:t.data.kfAccount,originData:t});break;default:BJ_REPORT.report("Unknown S_msg Type"+i)}}function H(){r({type:"sessionEnd",act:"new"}),Ee.kfChangeTip||(Ke.remove(),Ee.ioLinkStatus="sessionOver",Ee.wpaDetail.extUin=Ee.receptionist.extUin,Ee.isChangeKF=0)}function F(){pt.receiveMsg(we.SOCKET_CMD.B2C.RECEIVE,lt.normal.renderB2C),pt.receiveMsg(we.SOCKET_CMD.C2B.RECEIVE,lt.normal.sendRet),pt.receiveMsg(we.SOCKET_CMD.SESSION_MSG.RECEIVE,B),pt.receiveMsg(we.SOCKET_CMD.OVER.RECEIVE,H),pt.receiveMsg(we.SOCKET_CMD.ROUTE.RECEIVE,G)}function J(e,t){var e=e.body,i=$(t.target),n=Ee.getSigTData,a=Ee.receptionist,o=parseInt(Ee.originRoleValue);if(!i.hasClass("disabled")){switch(BJ_REPORT.info("KF Change"),i.addClass("disabled"),Ee.chatSocket.emitMsg(we.SOCKET_CMD.KF_CHANGE.EMIT,{kf:""}),4==n.invitationType&&(1==Ee.wpaDetail.reception.type?o=0:2==Ee.wpaDetail.reception.type&&(o=1)),o){case 0:Ee.wpaDetail.extUin=n.roleData;break;case 1:Ee.wpaDetail.extUin="group";break;case 2:Ee.wpaDetail.extUin=a.kfUin;break;default:BJ_REPORT.report("Unknown RoleValue"+o)}BJ_REPORT.info("KF Change ReConnect"),gt().reConnect()}}function j(e){var t,i,n,a,o=+new Date;$.ajax({type:"HEAD",url:we.CGI_URL.GET_SERVER_TIME+"?kfuin="+e,timeout:1e3,success:function(e,r,s){t=+new Date,i=+new Date(s.getResponseHeader("Date")),n=parseInt((t-o)/2),a=i+n-t,Ee.serverClientTimeDiff=a,BJ_REPORT.report("Time Diff "+a)}})}function W(){var e=Ee.win.location.href,t="0"==je(e,"linkType")?2:3,i=Ee.wpaDetail,n=Ee.receptionist,a=i.clickid;$.ajax({url:we.CGI_URL.ACT_RPT,data:{mid:"",id:i.wpaId,kfuin:n.kfUin,kfext:je(e,"kfext"),cate:je(e,"cate"),type:je(e,"type"),eventtp:t,tpForm:t,refurl:"undefined"!=typeof document.referrer?document.referrer:"",ua:Ee.userAgent,eptype:Ee.isMobile?2:1,clickid:a,pid:a,clickType:6,visitorid:n.visitorId,tptype:9},type:"POST",timeout:3e3,dataType:"json"})}function K(e,t,i,n){var a,s=i||"chatStart",c=t||we.CGI_URL.GET_SIGT,l=o(we.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),d="wpaShowItemId",u=0;return c==we.CGI_URL.GET_SIGT&&Ie.chatBtnSend.hasClass("enabled")&&Ie.chatBtnSend.removeClass("enabled"),"undefined"!=typeof e.visitorId&&Number(e.visitorId)?("undefined"==typeof e.reqSrc&&(e.kfuin&&j(e.kfuin),W()),$.extend(e,{ftype:Ee.isMobile,rolekey:"roleQQ",cb:s}),"undefined"!=typeof e[d]&&(mt.get(d)?delete e[d]:mt.set(d,"true")),Ee.win.chatStart=function(t){var i=t.data.sigT;Ee.isGetSignT=1,clearInterval(a),0==t.r?gt().prepareRegData({sigT:i,roleValue:e.roleValue,roleData:e.roleData,callImType:e.callImType,wpaShowItemId:e.wpaShowItemId}):r({type:"sigTfail",empty:!0})},a=ft({isGet:Ee.isGetSignT,timeout:we.SOCKET_OPTS.SIGT_TIMEOUT,text:"Get SigT Timeout ",callback:function(e){r({type:"sigTtimeOut",empty:!0}),BJ_REPORT.report(this.text)}}),$.ajax({type:"get",url:c,data:e,dataType:"jsonp",timeout:we.SOCKET_OPTS.SIGT_TIMEOUT,beforeSend:function(){u=+new Date},complete:function(){ze({type:3,requestConsumTime:+new Date-u,clickid:e.clickid})},error:function(e){}}),void(Ie.chatBody.hasClass("regsuccess")&&n&&(r({type:"startGetSigT",seq:l,act:"new"}),Ee.inRegProcess=l))):(r({type:"noVisitorId",empty:!0}),void BJ_REPORT.report("noVisitorId"))}function V(){var e=0;return function(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return e+=t}}function Q(e){var t=e.act,i={},n={},a=Ee.wpaDetail,o=Ee.chatSocket,r=vt();switch(t){case"INIT":var s={kfUin:e.kfuin,visitorId:e.visitorid,wpaId:e.wpaId};e.kfuin||(e.kfuin=0),$.extend(Ee.htReportOpts,{uin:e.kfuin+"-"+e.visitorid}),BJ_REPORT&&BJ_REPORT.init({uin:Ee.htReportOpts.uin}),St(Ee.htReportOpts),Ee.imStatus="close",i=et.get(s),"undefined"!=typeof i.number&&i.number>0&&($.extend(n,e,{type:"unReadMsg"}),Oe.statusBar.data("virtualWPAData",n),yt(i.number),et.render("update",i.number,{name:i.name,status:"留言了"}),De.send({act:"SHOW"}),$.extend(!0,e,{act:"UNREAD",data:{number:i.number,onlyOpen:!1}}),De.send(e)),$.extend(Ee.receptionist,{visitorId:e.visitorid,kfUin:e.kfuin});break;case"OPEN":var c={};if($.extend(Ee.receptionist,{visitorId:e.visitorid,kfUin:e.kfuin}),BJ_REPORT&&BJ_REPORT.init({uin:e.visitorid}),!Ee.isGetSkin&&r.getData({kfuin:e.kfuin,wpaId:e.wpaId,key:e.wpaKey}),Oe.page.removeClass("page-minify").addClass("page-inframe"),et.reset(Ee.receptionist),et.render("reset"),Ee.imStatus="open",e.onlyOpen)return;1==e.invitationType||2==e.invitationType?$.extend(e,{roleData:e.receptionUin,roleValue:0}):4==e.invitationType?$.extend(e,{roleData:e.reception.cuin,roleValue:e.reception.type}):3==e.invitationType&&$.extend(e,{roleData:e.receptionUin,roleValue:0,extUin:e.receptionUin}),"undefined"!=typeof e.invitationType&&(delete e.wpaId,delete e.wpaKey),c={kfuin:e.kfuin,visitorId:e.visitorid,roleValue:e.roleValue,roleData:e.roleData,invitationType:e.invitationType,wpaShowItemId:e.wpaShowItemId},Ee.originRoleValue=e.roleValue,e.isClickWpa&&$.extend(c,{cate:e.cate,type:e.type,clickid:e.clickid,fid:e.wpaId,pid:e.pid,qid:e.qid,clickType:e.clickType,tptype:e.tptype,eptype:e.eptype,tpForm:e.tpForm}),a.wpaKey||a.wpaId||Oe.chatBody.hasClass("regsuccess")?a.wpaKey!=e.wpaKey&&a.wpaId!=e.wpaId&&(Ee.wpaDetail=e,Ee.getSigTData=c,K(c)):(Ee.wpaDetail=e,Ee.getSigTData=c,K(c));break;case"UPDATE_UNREAD":var l=parseInt(e.number),d="undefined"!=typeof e.theme?e.theme:null;null!==d&&r.skinColor(d),l>0&&(n=a={type:"offlineMsg",roleData:e.receptionUin,roleValue:e.roleValue,extUin:e.receptionUin,kfuin:e.kfuin,visitorid:Ee.receptionist.visitorId,invitationType:3},Oe.statusBar.data("virtualWPAData",n),et.render("update",yt()+parseInt(e.number),{name:e.receptionName,status:"交谈中"}),De.send({act:"SHOW"}));break;case"DISCONNECT":"undefined"!=typeof o.ioLink&&o.ioLink.disconnect();break;case"SM_READY":break;case"SM_INIT":break;case"SM_UNREAD":break;default:BJ_REPORT.report("Unknown Message["+JSON.stringify(e)+"]")}}function z(e){$("body").delegate('a[href^="javascript:"]',"click",function(e){e.preventDefault()}),$(window).bind("beforeunload",function(){return e.apply(this,arguments)})}function Y(){z(function(){return"您正在与客服会话，是否离开"})}function X(e){var t=0;if(document.selection){e.focus();var i=document.selection.createRange();i.moveStart("character",-e.value.length-1),t=i.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t}function Z(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var i=e.createTextRange();i.collapse(!0),i.moveEnd("character",t),i.moveStart("character",t),i.select()}}function ee(e,t,i){var n=document.getElementsByTagName("script"),a=n[n.length-1],o=document.createElement("script"),r=!1;o.src=e,o.async=!0,a.parentNode.insertBefore(o,a),o.onload=o.onreadystatechange=function(){r||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(r=!0,t&&t.apply(i,arguments),o.onload=o.onreadystatechange=null)}}function te(){Oe.faceList.on("show",function(){Oe.faceList.addClass("slideup"),bt.render()}),Oe.faceList.on("hide",function(){Oe.faceList.removeClass("slideup")}),$("body").on("click",function(e){var t=$(e.target);0==t.parents(".chat-face").length&&0==t.parents(".btn-face").length&&Oe.faceList.trigger("hide")})}function ie(){var e=(window.emoji=!1,~Ee.userAgent.indexOf("mac os"));te(),!Ee.isInIframe&&Y(),e&&Oe.chatPostArea.prop("placeholder","请输入，按Enter直接发送消息，Shift+Enter换行"),Oe.chatPostArea.on("init",function(){Oe.chatPostArea.val("")}),Oe.btnFace.on("click",function(){Oe.faceList.trigger(Oe.faceList.hasClass("slideup")?"hide":"show")}),"undefined"!=typeof Ee.win.EmojiConvertor&&(Ee.win.emoji=new EmojiConvertor,Ee.win.emoji.img_sets.apple.path=ht.CGI_URL.COMP_SOURCE_URL+"img/emoji/")}function ne(e,t,i,n,a){_(function(o){o.append('<div class="confirm"><p class="text">'+e+'</p><p class="btn-wrap"><a href="javascript:;">确定</a><a href="javascript:;">取消</a></p></div>'),o.find(".btn-wrap a").eq(0).on("tap",function(){o.remove(),t&&t.call(i)}),o.find(".btn-wrap a").eq(1).on("tap",function(){o.remove(),n&&n.call(a)})})}function ae(){var e=window.navigator.connection||window.navigator.webkitConnection||null,t=window.navigator.userAgent.toLocaleLowerCase();return e&&e.type&&"wifi"==e.type||-1!==t.indexOf("wifi")?!0:!1}function oe(e){this.options={},$.extend(this.options,e),this.initialize()}function re(){var e=WebUploader.create({auto:!0,swf:ht.CGI_URL.COMP_SOURCE_URL+"swf/Uploader.swf",server:ht.CGI_URL.UPLOAD_IMG,formData:{visitId:Ee.receptionist.visitorId,receptionUin:Ee.receptionist.extUin},fileVal:"media",pick:"#btn-swfupload",fileNumLimit:ht.IMG_UPLOAD_OPTS.MAX_SUM,fileSingleSizeLimit:ht.IMG_UPLOAD_OPTS.MAX_SIZE,accept:{title:"图片文件",extensions:ht.IMG_UPLOAD_OPTS.ACCEPT_TYPE_SWFUPLOAD,mimeTypes:"image/*"},thumb:{width:200,height:200,quality:90,allowMagnify:!1,crop:!1,type:""},compress:!1});$(".upload-placeholder").hover(function(){Oe.btnUpload.addClass("hover")},function(){Oe.btnUpload.removeClass("hover")}),e.on("fileQueued",function(t){var i={seq:o(ht.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),date:+new Date};lt.normal.render("c2bImage",{seq:i.seq,date:i.date},"msg"),$.extend(t,i),e.makeThumb(t,function(e,t){i.DataURL=t,$.extend(i,{DataURL:t}),lt.image.replacePlaceholder(i)},200,200)}),e.on("uploadSuccess",function(e,t){var i={seq:e.seq,date:e.data};lt.renderUploadImgRet(i,t)}),e.on("uploadError",function(e,t){lt.image.sendFail(e,"notSupport")}),e.on("error",function(e){"Q_EXCEED_NUM_LIMIT"==e&&lt.image.sendFail(file,"overSumLimit")})}function se(){var e,t,i,n=0,o=~Ee.userAgent.indexOf("mac os"),r=o?16:17,s=11.4;Oe.chatBtnSend.on("click",function(e){ce()}),Oe.chatPostArea.on("keydown",function(e){e.which==r&&(n=1),13!=e.which||1!=n||o?13==e.which&&0==n&&(e.preventDefault(),ce()):Oe.chatPostArea.val(Oe.chatPostArea.val()+"\r\n").scrollTop(Oe.chatPostArea.prop("scrollHeight")-Oe.chatPostArea.outerHeight())}).on("keyup",function(e){e.which==r&&(n=0)}),window.FormData?e=new oe({$trigger:Oe.btnUpload,$inputTrigger:Oe.uploadInput,isNeedWifiTip:!1,initializeCallBack:function(){Oe.chatPostArea.trigger("slideDown")},events:{preview:function(e,t){lt.image.render(e,t)},replacePlaceholder:function(e){lt.image.replacePlaceholder(e)}}}):(t=Et(),1!=t.hasFlash?i=ht.FLASH_TIP.NO_FLASH:t.flashVersion<=s&&(i=ht.FLASH_TIP.LOW_VERSION),i?Oe.btnUpload.on("click",function(){p({text:i},1e3)}):window.WebUploader&&re()),a(Oe.chatPostArea[0],"paste",function(t){var i,n,a;try{i=t.clipboardData||t.originalEvent.clipboardData,n=i.items,a=n.length;for(var o=0;a>o;o++)"file"==n[o].kind&&n[o].type.match("^image/")&&e.checkImgTypeLocal([n[o].getAsFile()])}catch(t){}})}function ce(){var e,t=$.trim(Oe.chatPostArea.val());Oe.chatBtnSend.hasClass("enabled")&&wt(t)&&(e={data:t,seq:o(ht.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),type:1,wordMsgSeq:o(ht.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PC),date:+new Date+Ee.serverClientTimeDiff},lt.normal.render("c2b",e),Oe.chatPostArea.trigger("init"))}function le(){var e={};Oe.page.removeClass("page-popup").addClass("page-minify"),$(".btn-back").on("click",function(e){De.send({act:"CLOSE",kfuin:Ee.receptionist.kfUin}),Ee.imStatus="close",Oe.page.removeClass("page-inframe").addClass("page-minify"),Oe.statusBar.find(".name").text(Ee.receptionist.name).end().find(".status").text("交谈中")}),$(document).delegate("div.title-minify","click",function(){e=$(this).data("virtualWPAData"),Oe.page.hasClass("page-minify")&&(De.send({act:"OPEN",isPost2Parent:!1}),e&&($.extend(e,{act:"OPEN",isPost2Parent:!0}),window.postMessage(e,"*")),Oe.page.removeClass("page-minify").addClass("page-inframe"))})}function de(e){ee(we.CGI_URL.STATUS_MANAGER,function(){"undefined"!=typeof e&&De.receive(Ee.win,e)})}function ue(){function e(){return Math.round(2147483647*(Math.random()||.5))*+new Date%1e10;
}function t(){var e=c(a);return o&&(e?Ge.set(a,e):e=Ge.get(a)),e}function i(){var t=e();return o?Ge.set(a,t):s(name,t,null,"/",31536e6),t}var n,a="tencentSig",o="undefined"==typeof Ge.type||"memory"===Ge.type?!0:!1;return n=t(),n||(n=i()),n}function pe(e){var t,i=["kfuin","roleValue","roleData","fid","clickid","waitTime","callImType","wpaShowItemId"],n=Ee.win.location.href,a=je(n,"paramSwitch"),o=a&&1==a?je(n,"visitorId"):ue(),r={visitorId:o,cate:7,type:10,pid:Ct,qid:Ct,clickType:6,tptype:9,eptype:Ee.isMobile?2:1,tpForm:2},s={},c={};i.forEach(function(e){r[e]=je(n,e)}),r.kfuin||(r.kfuin=0),t=r.kfuin+"-"+o,$.extend(Ee.htReportOpts,{uin:t}),BJ_REPORT&&BJ_REPORT.init({uin:Ee.htReportOpts.uin}),St(Ee.htReportOpts),"undefined"!=typeof r.clickid&&r.clickid?Ee.wpaDetail.clickid=r.clickid:Ee.wpaDetail.clickid=r.clickid=Ct,s.visitorId=o,s.kfUin=r.kfuin,c.wpaId=je(n,"fid"),c.wpaKey=je(n,"key"),$.extend(Ee.receptionist,s),$.extend(Ee.wpaDetail,c),Ee.getSigTData=r,Ee.originRoleValue=r.roleValue,e&&e(),K(r)}function fe(){this.version="2.0.0",this.start=function(){$.extend(Ee.htReportOpts,{platform:"pc",app:"other",flag3:1}),ie(),Ee.regSuccessCallBack=se,Ee.isInIframe?(De.receive(Ee.win,Q),le()):(de(Q),pe(function(){!Ee.isGetSkin&&vt().getData({kfuin:Ee.receptionist.kfUin,wpaId:Ee.wpaDetail.wpaId,key:Ee.wpaDetail.wpaKey})}))}}var ge=function(){return window.parent==window?!1:!0}(),me=window,he=me.document,ve="QD.",Se=function(e){return e.toString(36)},ye=function Rt(e){var Rt=1;if(e){var t=0;Rt=0;for(var i=e.length-1;i>=0;i--)t=e.charCodeAt(i),Rt=(Rt<<6&268435455)+t+(t<<14),t=266338304&Rt,Rt=0!=t?Rt^t>>21:Rt}return Rt},Te=function Mt(){var Mt;try{var e=new Uint32Array(1);me.crypto.getRandomValues(e),Mt=2147483647&e[0]}catch(t){Mt=Math.floor(2147483648*Math.random())}return Mt},be=function(e){var t=me.navigator.userAgent+(he.cookie?he.cookie:"")+(he.referrer?he.referrer:"")+me.location.href,i=Se(Te()^2147483647&ye(t))+"."+Se(Te())+"."+Se(+new Date);return e?ve+i:i},_e=9,we={MAX_POST_LIMIT:{LENGTH:4500,TIP_TEXT:"发送消息内容过长，请分条发送。"},VIEW_OPTS:{POST_MAX_ROW:3,TIME_INTERVAL:12e4,HISTORY_MSG:{PER_NUM:10,GET_MSG:"点击加载更多历史消息",LOADING:"正在加载历史消息"},OFFLINE_MSG:{LOADING:"正在加载新消息",FAIL:"新消息加载失败，点击重试",OVER:"以下为未读消息"},MENU_MSG:{LOADING:"正在加载菜单导航",FAIL:"菜单导航加载失败，点击重试"}},CGI_URL:{SOCKET_CHAT:"https://"+__domain.chat+".qidian.qq.com",STATUS_MANAGER:"https://bqq.gtimg.com/qidian/chatClient/release/status/js/report-af9fe41b9.js",QQ_FACE:"https://"+__domain.source+".com/qidian/chatClient/release/comp/img/qq/",GET_SIGT:"https://"+__domain.admin+".qidian.qq.com/webim/webImLogin/getSigT",GET_TENCENT_SCHEME:"https://"+__domain.admin+".qidian.qq.com/tp/wpaCall/getWebProtocol",UPLOAD_IMG:"https://"+__domain.admin+".qidian.qq.com/webim/pic/upload",ROUTE_CHANGE_LOADING:{QQ:"https://"+__domain.admin+".qidian.qq.com/template/blue/wpa/link.html"},GET_GRAPHIC_MSG:"https://"+__domain.admin+".qidian.qq.com/webim/innerPage/getGraphicMsg",GET_OFFLINE_MSG:"https://"+__domain.admin+".qidian.qq.com/webim/offlineMessage/getMessages",COMP_SOURCE_URL:"https://"+__domain.source+".com/qidian/chatClient/release/comp/",GET_MENU_URL:"https://"+__domain.admin+".qidian.qq.com/webim/innerPage/getNav",GET_FEEDBACK_RET:"https://"+__domain.admin+".qidian.qq.com/webim/innerPage/feedBack",ACT_RPT:"https://"+__domain.admin+".qidian.qq.com/ar/ActCap/ActRpt",GET_SERVER_TIME:"https://"+__domain.admin+".qidian.qq.com/webim/commonRequest/checkTime",GET_ADD_FRIEND_SCHEME:"https://"+__domain.admin+".qidian.qq.com/tp/wpaCall/GetAddFriendProtocol"},SOCKET_OPTS:{OPTS:{path:"/session",reconnectionDelay:1e4,reconnectionDelayMax:2e4,reconnectionAttempts:2,timeout:2e4},C2B_TIMEOUT:6e4,SIGT_TIMEOUT:6e4,REG_TIMEOUT:6e4,SEQ_RANGE:{C2B_FOR_PHP:2147483647,C2B_FOR_PC:65535},CLIENT_PING_DELAY:2e4},IMG_UPLOAD_OPTS:{MAX_SUM:_e,MAX_SIZE:2097152,MAX_WIDTH:540,MAX_HEIGHT:960,JPG_COMPRESS_RATIO:60,ACCEPT_TYPE:["image/jpeg","image/jpg","image/bmp","image/png","image/gif"],ACCEPT_TYPE_SWFUPLOAD:"gif,jpg,jpeg,bmp,png"},MSG_DB_OPTS:{NAME:"Qidian WebIM History Message Database",CURRENT_VERSION:3},FB_OPTS:{levelDesc:["非常不满意","不满意","一般","满意","非常满意"],availLetterSum:60,delayTime:500},HEADER_TPL:{BTN_BACK:'<a href="javascript:;" class="btn-back"><svg><use xlink:href="#back"/></svg></a>',H5:{BTN_CALL_QQ:'<a href="javascript:;" class="btn-callqq" reqpos="0"><svg><use xlink:href="#qq"/></svg></a>'},PC:{BTN_CALL_QQ:'<a href="javascript:;" class="btn-callqq" reqpos="0"><i class="icon-qq"></i>去QQ交谈<i class="icon-arrow-right"></i></a>'}},SYS_MSG:{sessionEnd:"本次咨询已结束，发送消息可开始新的咨询",disconnect:"当前会话网络已中断，请刷新页面或再发条消息试试",changeKf:'您可以和当前客服继续咨询或开始<a href="javascript:;" class="btn-newkf">新的咨询</a>',reReg:"网络有点问题无法接入客户，请刷新页面再试试",connect:"与服务器连接成功，请等待接入",connecting:"正在与服务器建立连接",connectError:"服务连接失败，即将自动为您重新建立连接",reconnectError:"服务连接失败，即将自动为您重新建立连接",reconnectIng:"正在重新与服务器建立连接",reconnectFail:" 当前网络有点问题，请刷新页面或再发条消息试试",callqq:"客服暂时不在线，您可直接发起QQ会话进行咨询",wpaDisabled:"接待组件已失效",sigTtimeOut:"获取鉴权超时，请刷新页面再试试",regTimeout:"建立会话超时，请刷新页面再试试",regSuccess:"会话接入成功，开始服务",startGetSigT:"正在获取鉴权信息",sigTfail:"获取鉴权失败，请刷新页面再试试",overSumLimit:"图片数目超过最大"+_e+"张限制",msgExpired:"此消息已过期",feedBack:"感谢您的意见和建议，我们将继续努力",autoChangeKF:"原客服不在线，已为您自动更换在线的客服",noVisitorId:"无法获取访客ID，请刷新页面重试",addFriendFail:'添加好友失败，请点击名片重试或<a href="javascript:;" class="btn-paste">复制QQ号</a>手动添加',graphicMsgFail:"服务暂不可用，请稍后重试"},CHAT_MSG_TPL:{time:'<div class="msg-time"><%==timeStamp%></div>',sys:'<div class="msg-sys" data-guid="<%=seq%>">\n                    <span class="text"><%==msg%></span>\n                </div>',b2c:'<div class="msg-b2c" data-guid="<%=seq%>"><p class="avatar"><img src="<%=avatar%>"/></p><div class="content"><p class="name"><%=name%></p><div class="bubble"><p class="text"><%==data%></p></div></div></div>',b2cImage:'<div class="msg-b2c msg-image" data-guid="<%=seq%>"><p class="avatar"><img src="<%=avatar%>"/></p><div class="content"><p class="name"><%=name%></p><div class="bubble"><p class="image"><img src="<%=data%>"/><i class="loading loading-s"></i></p></div></div></div>',b2cWrap:'<div class="msg-b2c <%=o.msgType%> <%=o.msgName%>" data-guid="<%=o.seq%>">\n                        <p class="avatar"><img src="<%=o.face || o.avatar%>"/></p>\n                        <div class="content">\n                            <p class="name"><%=o.name%></p>\n                            <div class="bubble">msgContent</div>\n                        </div>\n                    </div>',c2b:'<div class="msg-c2b" data-guid="<%=seq%>"><div class="bubble"><i></i><p class="text"><%==data%></p></div></div>',c2bImage:'<div class="msg-c2b msg-image" data-guid="<%=seq%>"><div class="bubble"><i></i><p class="image"><img src="<%=data%>"/></p></div></div>',c2bWrap:'<div class="msg-c2b <%=o.msgType%> <%=o.msgName%>" data-guid="<%=o.seq%>">\n                    <div class="bubble">msgContent</div>\n                </div>',callqq:'<div class="msg-offline">\n                        <div class="content">\n                            <div class="kf-detail">\n                                <p class="avatar"><img src="<%=avatar%>"/></p>\n                                <dl class="detail">\n                                    <dt><%=name%></dt>\n                                    <dd><%=corpName%><span class="resign"><%=resign%></span></dd>\n                                </dl>\n                            </div>\n                            <a href="javascript:;" class="btn-act" reqpos="1">发起QQ会话</a>\n                        </div>\n                    </div>',b2cKfChange:"会话已转接到<%=o.name%>，欢迎继续咨询",msgLoad:{getMsg:'<div class="load-status"><a href="javascript:;" class="btn-load-msg"><%==text%></a></div>',loading:'<div class="load-status"><p class="status-loading"><i class="loading loading-s"></i><span class="text"><%==text%></span></p></div>',overTip:'<p class="status-tip"><span class="text"><%==text%></span></p>',numTip:'<a href="javascript:;" class="btn-offlinemsg-gotop"><%==text%>条新消息<i class="icon-arrow-up"></i></a>'},menuMsgNormal:'<div class="mod-menu <% if(o.config.welcome == 1) { %>wel<% } %><% if(o.config.menu == 1) { %>nav<% } %><% if(o.config.button == 1) { %>btn<% } %>" data-guid="<%=o.guid%>" data-oldver="<% if(o.version >= o.currentVersion) {%>0<%} else {%>1<%}%>">\n                    <div class="menu-wrap"><% if(o.version >= o.currentVersion) { %>\n                        <% if(o.config.welcome == 1) { %><div class="menu-wel">\n                            <div class="tit">\n                                <dl>\n                                    <dt><img src="<%=o.eLogo%>" width="25" height="25"/></dt>\n                                    <dd><%=o.welcome.tit%></dd>\n                                </dl>\n                            </div>\n                            <p class="text"><%=o.welcome.intro%></p>\n                        </div><% } %>\n                        <% if(o.config.menu == 1) { %><div class="menu-nav">\n                            <p class="tit"><%=o.menu.tit%></p>\n                            <% for(var i = 0, l = o.menu.list.length;i<l;i++) {%><div class="nav-item">\n                                <div class="nav-hd">\n                                    <a href="javascript:;" data-action="<%= o.menu.list[i].action%>" data-replytype="<%= o.menu.list[i].manualType || o.menu.list[i].replyType %>" data-replydata="<%=o.menu.list[i].serviceKfext || o.menu.list[i].groupId || o.menu.list[i].replyText || o.menu.list[i].imgurl || o.menu.list[i].url || o.menu.list[i].materialId%>"><span class="text"><%= o.menu.list[i].name%></span> <% if(o.menu.list[i].action == 4 && o.menu.list[i].sublist) { %><i class="icon-arrow-down"><% if(o.isMobile) { %><svg><use xlink:href="#back"/></svg><% } %></i><% } %></a>\n                                </div><% if(o.menu.list[i].action == 4 && o.menu.list[i].sublist) { %>\n                                <div class="nav-bd">\n                                    <ul><% for(var k = 0, len = o.menu.list[i].sublist.length;k<len;k++) {%>\n                                        <li><a href="javascript:;" data-action="<%= o.menu.list[i].sublist[k].action%>" data-replytype="<%= o.menu.list[i].sublist[k].manualType || o.menu.list[i].sublist[k].replyType %>" data-replydata="<%= o.menu.list[i].sublist[k].serviceKfext || o.menu.list[i].sublist[k].groupId || o.menu.list[i].sublist[k].replyText || o.menu.list[i].sublist[k].imgurl || o.menu.list[i].sublist[k].url || o.menu.list[i].sublist[k].materialId%>"><%= o.menu.list[i].sublist[k].name%></a></li><% } %>\n                                    </ul>\n                                </div><% } %>\n                            </div><% } %>\n                        </div><% } %>\n                        <% if(o.config.button == 1) { %><div class="menu-action">\n                            <ul><% for(var i = 0, l = o.button.length;i<l;i++) {%>\n                                <li style="width:<%= o.buttonWidth %>%"><a href="javascript:;" data-action="<%= o.button[i].action%>" data-replytype="<%= o.button[i].manualType || o.button[i].replyType %>" data-replydata="<%= o.button[i].serviceKfext || o.button[i].groupId || o.button[i].replyText || o.button[i].imgurl || o.button[i].url%>"><%= o.button[i].name%></a></li><% } %>\n                            </ul>\n                        </div><% } %><% } else { %>\n                        <div class="menu-disabled">\n                            <dl>\n                                <dt></dt>\n                                <dd>历史数据已失效</dd>\n                            </dl>\n                        </div><% } %>\n                    </div>\n                  </div>',menuMsgExpired:'<div class="menu-disabled">\n                            <dl>\n                                <dt></dt>\n                                <dd>历史数据已失效</dd>\n                            </dl>\n                        </div>',feedback:'<div class="mod-fb" data-fbkey=<%= o.fbKey %>>\n                            <div class="fb-wrap">\n                                <p class="tit">请对客服的服务质量进行评价</p>\n                                <div class="fb-level">\n                                    <% for(var i = 0;i < o.levelDesc.length; i++) {%><a href="javascript:;" data-desc="<%= o.levelDesc[i] %>"><% if(o.isMobile) { %><svg><use xlink:href="#star"/></svg><% } else { %><i class="icon-star"></i><% } %></a><% } %>\n                                </div><% if(o.hasDesc) {%>\n                                <div class="fb-desc">\n                                    <p class="level-desc"></p>\n                                    <div class="post-text"><p class="text"></p></div>\n                                    <div class="post-area">\n                                        <textarea maxlength="<%= o.availLetterSum %>" placeholder="感谢您的评分，可留下其他意见或建议。"></textarea>\n                                        <span class="num"><%= o.availLetterSum %></span>\n                                    </div>\n                                    <a href="javascript:;" class="btn-submit">提交</a>\n                                </div><% } %>\n                                <button class="fb-loading">正在提交评价</button>\n                            </div>\n                        </div>',blackTip:'<div class="mod-black-tip"><p class="text"><%= o.text %></p></div>'},RICH_MSG_TPL:['<% if(!o.isNeedWrap) {%><div class="mod-richmsg" data-guid="<%=o.seq%>"><% } %>\n            <div class="richmsg-type-0">\n                <div class="content">\n                    <dl>\n                        <dt class="title"><a href="javascript:;" action="<%=o.title.action%>" url="<%=o.title.url%>"><p><%=o.title.text%></p></a></dt>\n                        <dd class="thumb"><a href="javascript:;" action="<%=o.title.action%>" url="<%=o.title.url%>"><img src="<%=o.picture.cover%>"/></a></dd>\n                    </dl>\n                </div>\n                <div class="buttons"><% for(var i = 0, l = o.buttons.length;i<l;i++) {%>\n                    <a href="javascript:;" class="action" action="<%=o.buttons[i].action%>" actionData="<%=o.buttons[i].actionData%>"><%=o.buttons[i].text%></a>\n                </div><% } %>\n            </div>\n            <% if(!o.isNeedWrap) {%></div><% } %>','<div class="richmsg-type-1">\n            <div class="content">\n                <h2 class="title"><%=o.title.text%></h2>\n                <p class="thumb"><a href="javascript:;" class="action" action="<%=o.picture.action%>" actionData="<%=o.picture.actionData%>"><img src="<%=o.picture.cover || o.face%>"/></a></p>\n                <dl class="detail">\n                    <dt><a href="javascript:;" class="action" action="<%=o.detailText.mainText.action%>" actionData="<%=o.detailText.mainText.actionData%>"><%=o.detailText.mainText.text%></a></dt>\n                    <dd><a href="javascript:;" class="action" action="<%=o.detailText.subText.action%>" actionData="<%=o.detailText.subText.actionData%>"><%=o.detailText.subText.text%></a></dd>\n                </dl>\n            </div>\n        </div>',{simple:'\n                    <div class="richmsg-type-2">\n                        <div class="content simple" actionData="<%=o.data[0].url%>" action="web">\n                            <h2 class="title"><%=o.data[0].title%></h2>\n                            <h3 class="date"><%=o.data[0].date%></h3>\n                            <div class="thumb">\n                                <div class="img" style="background-image: url(<%=o.data[0].cover%>)"></div>\n                            </div>\n                            <div class="summary"><%=o.data[0].summary%></div>\n                            <div class="detail"><span>阅读原文</span><span class="arrow"></span></div>\n                        </div>\n                    </div>\n                    ',multiple:'\n                      <div class="richmsg-type-2">\n                          <ul class="content multiple">\n                              <% for (var i = 0;i < o.data.length; i++) { %>\n                                  <% if (i == 0) { %>\n                                      <li class="article main">\n                                          <div class="thumb" action="web" actionData="<%=o.data[i].url%>">\n                                              <div class="img" style="background-image: url(<%=o.data[i].cover%>)"></div>\n                                              <div class="title-wrap">\n                                                  <div class="title"><%=o.data[i].title%></div>\n                                              </div>\n                                          </div>\n                                      </li>\n                                  <% } else { %>\n                                      <li class="article sub">\n                                          <div class="thumb" action="web" actionData="<%=o.data[i].url%>">\n                                              <div class="title"><div><%=o.data[i].title%></div></div>\n                                              <div class="img" style="background-image: url(<%=o.data[i].cover%>)"></div>\n                                          </div>\n                                      </li>\n                                  <% } %>\n                              <% } %>\n                          </ul>\n                      </div>\n                      '}],SOCKET_CMD:{REG:{EMIT:"register",RECEIVE:"register ack"},C2B:{EMIT:"message c2b",RECEIVE:"message c2b ack"},B2C:{RECEIVE:"message b2c",EMIT:"message b2c ack"},KF_CHANGE:{EMIT:"change kf",RECEIVE:"change kf ack"},ROUTE:{RECEIVE:"route change",EMIT:"route change ack"},OVER:{RECEIVE:"session over"},SESSION_MSG:{RECEIVE:"s_msg",EMIT:"s_msg_ack"},CLIENT_PING:{EMIT:"p"}}},Ee={win:window,receptionist:{},wpaDetail:{},getSignTData:{},kfChangeTip:0,isGetSignT:0,isRegOK:0,isMobile:0,isChangeKF:0,inRegProcess:0,isRealSendMsg:1,isInIframe:ge,defaultAvatar:we.CGI_URL.COMP_SOURCE_URL+"img/default-avatar.png",imageLoadFail:we.CGI_URL.COMP_SOURCE_URL+"img/image-load-fail.png",reSendC2bMsg:null,ioLinkStatus:null,regSuccessCallBack:null,imStatus:"open",pageStatus:"show",clickName:"click",chatSocket:new e,c2bDBsaveData:[],c2bSeqGroup:[],menuDetail:{active:0,currentVersion:"",eLogo:"",eName:"",defaultConfig:{active:0}},seqs:{key:"",data:[]},getSigTData:{},originRoleValue:null,clientPingTimer:null,serverClientTimeDiff:0,htReportOpts:{flag1:21873,flag2:1}},Ce=Ee.win.navigator.userAgent.toLocaleLowerCase();Ee.userAgent=Ce,$.extend(Ee,!0,{isGetSkin:0});var Ie={chatBody:$("body"),header:$(".title-normal"),callGroup:$(".call-group"),chatList:$(".chat-list"),modList:$(".mod-list"),chatListWrap:$(".chat-list .list-wrap"),chatPost:$(".chat-post"),chatBtnSend:$(".btn-send"),btnUpload:$(".btn-upload"),btnFace:$(".btn-face"),faceList:$(".chat-face"),uploadInput:$("input[type=file]")},Oe=$.extend(!0,{},Ie,{page:$(".page"),chatPostArea:$(".post-area"),unReadMsgNum:$(".unread-msg-num"),statusBar:$(".title-minify")}),ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},Re=function(e){if(e.BJ_REPORT)return e.BJ_REPORT;var t=[],i={},n={id:0,uin:0,url:"",offline_url:"",offline_auto_url:"",ext:null,level:4,ignore:[],random:1,delay:1e3,submit:null,repeat:5,offlineLog:!1,offlineLogExp:5,offlineLogAuto:!1},a={db:null,ready:function(e){var t=this;if(!window.indexedDB||!n.offlineLog)return n.offlineLog=!1,e();if(this.db)return void setTimeout(function(){e(null,t)},0);var i=1,a=window.indexedDB.open("badjs",i);return a?(a.onerror=function(t){return e(t),n.offlineLog=!1,!0},a.onsuccess=function(i){t.db=i.target.result,setTimeout(function(){e(null,t)},500)},void(a.onupgradeneeded=function(e){var t=e.target.result;t.objectStoreNames.contains("logs")||t.createObjectStore("logs",{autoIncrement:!0})})):(n.offlineLog=!1,e())},insertToDB:function(e){var t=this.getStore();t.add(e)},addLog:function(e){this.db&&this.insertToDB(e)},addLogs:function(e){if(this.db)for(var t=0;t<e.length;t++)this.addLog(e[t])},getLogs:function(e,t){if(this.db){var i=this.getStore(),n=i.openCursor(),a=[];n.onsuccess=function(i){var n=i.target.result;n?(n.value.time>=e.start&&n.value.time<=e.end&&n.value.id==e.id&&n.value.uin==e.uin&&a.push(n.value),n["continue"]()):t(null,a)},n.onerror=function(e){return t(e),!0}}},clearDB:function(e){if(this.db){var t=this.getStore();if(!e)return void t.clear();var i=Date.now()-24*(e||2)*3600*1e3,n=t.openCursor();n.onsuccess=function(e){var n=e.target.result;n&&(n.value.time<i||!n.value.time)&&(t["delete"](n.primaryKey),n["continue"]())}}},getStore:function(){var e=this.db.transaction("logs","readwrite");return e.objectStore("logs")}},o={isOBJByType:function(e,t){return Object.prototype.toString.call(e)==="[object "+(t||"Object")+"]"},isOBJ:function(e){var t="undefined"==typeof e?"undefined":ke(e);return"object"===t&&!!e},isEmpty:function(e){return null===e?!0:o.isOBJByType(e,"Number")?!1:!e},extend:function(e,t){for(var i in t)e[i]=t[i];return e},processError:function(e){try{if(e.stack){var t=e.stack.match("https?://[^\n]+");t=t?t[0]:"";var i=t.match(":(\\d+):(\\d+)");i||(i=[0,0,0]);var n=o.processStackMsg(e);return{msg:n,rowNum:i[1],colNum:i[2],target:t.replace(i[0],""),_orgMsg:e.toString()}}return e.name&&e.message&&e.description?{msg:JSON.stringify(e)}:e}catch(a){return e}},processStackMsg:function(e){var t=e.stack.replace(/\n/gi,"").split(/\bat\b/).slice(0,9).join("@").replace(/\?[^:]+/gi,""),i=e.toString();return t.indexOf(i)<0&&(t=i+"@"+t),t},isRepeat:function(e){if(!o.isOBJ(e))return!0;var t=e.msg,a=i[t]=(parseInt(i[t],10)||0)+1;return a>n.repeat}},r=e.onerror;e.onerror=function(t,i,n,a,s){var c=t;s&&s.stack&&(c=o.processStackMsg(s)),o.isOBJByType(c,"Event")&&(c+=c.type?"--"+c.type+"--"+(c.target?c.target.tagName+"::"+c.target.src:""):""),m.push({msg:c,target:i,rowNum:n,colNum:a,_orgMsg:t}),g(),r&&r.apply(e,arguments)};var s=function(e,t){var i=[],a=[],r=[];if(o.isOBJ(e)){e.level=e.level||n.level;for(var s in e){var c=e[s];if(!o.isEmpty(c)){if(o.isOBJ(c))try{c=JSON.stringify(c)}catch(l){c="[BJ_REPORT detect value stringify error] "+l.toString()}r.push(s+":"+c),i.push(s+"="+encodeURIComponent(c)),a.push(s+"["+t+"]="+encodeURIComponent(c))}}}return[a.join("&"),r.join(","),i.join("&")]},c=[],l=function(e,t){return t=o.extend({id:n.id,uin:n.uin,time:new Date-0},t),a.db?void a.addLog(t):(a.db||c.length||a.ready(function(e,t){t&&c.length&&(t.addLogs(c),c=[])}),void c.push(t))},d=function(){var e=document.createElement("script");e.src=n.offline_auto_url||n.url.replace(/badjs$/,"offlineAuto")+"?id="+n.id+"&uin="+n.uin,window._badjsOfflineAuto=function(e){e&&Re.reportOfflineLog()},document.head.appendChild(e)},u=[],p=0,f=function(){if(clearTimeout(p),u.length){var e=n._reportUrl+u.join("&")+"&count="+u.length+"&_t="+ +new Date;if(n.submit)n.submit(e);else{var t=new Image;t.src=e}p=0,u=[]}},g=function(e){if(n._reportUrl){for(var i=Math.random()>=n.random;t.length;){var a=!1,r=t.shift();if(r.msg=(r.msg+""||"").substr(0,500),!o.isRepeat(r)){var c=s(r,u.length);if(o.isOBJByType(n.ignore,"Array"))for(var d=0,g=n.ignore.length;g>d;d++){var m=n.ignore[d];if(o.isOBJByType(m,"RegExp")&&m.test(c[1])||o.isOBJByType(m,"Function")&&m(r,c[1])){a=!0;break}}a||(n.offlineLog&&l("badjs_"+n.id+n.uin,r),i||20==r.level||(u.push(c[0]),n.onReport&&n.onReport(n.id,r)))}}e?f():p||(p=setTimeout(f,n.delay))}},m=e.BJ_REPORT={push:function(e){var i=o.isOBJ(e)?o.processError(e):{msg:e};if(n.ext&&!i.ext&&(i.ext=n.ext),i.from||(i.from=location.href),i._orgMsg){var a=i._orgMsg;delete i._orgMsg,i.level=2;var r=o.extend({},i);r.level=4,r.msg=a,t.push(i),t.push(r)}else t.push(i);return g(),m},report:function(e,t){return e&&m.push(e),t&&g(!0),m},info:function(e){return e?(o.isOBJ(e)?e.level=2:e={msg:e,level:2},m.push(e),m):m},debug:function(e){return e?(o.isOBJ(e)?e.level=1:e={msg:e,level:1},m.push(e),m):m},reportOfflineLog:function(){return window.indexedDB?void a.ready(function(e,t){if(t){var i=new Date-0-24*n.offlineLogExp*3600*1e3,a=new Date-0;t.getLogs({start:i,end:a,id:n.id,uin:n.uin},function(e,t){var o=document.createElement("iframe");o.name="badjs_offline_"+(new Date-0),o.frameborder=0,o.height=0,o.width=0,o.src="javascript:false;",o.onload=function(){var e=document.createElement("form");e.style.display="none",e.target=o.name,e.method="POST",e.action=n.offline_url||n.url.replace(/badjs$/,"offlineLog"),e.enctype.method="multipart/form-data";var r=document.createElement("input");r.style.display="none",r.type="hidden",r.name="offline_log",r.value=JSON.stringify({logs:t,userAgent:navigator.userAgent,startDate:i,endDate:a,id:n.id,uin:n.uin}),o.contentDocument.body.appendChild(e),e.appendChild(r),e.submit(),setTimeout(function(){document.body.removeChild(o)},1e4),o.onload=null},document.body.appendChild(o)})}}):void Re.info("unsupport offlineLog")},offlineLog:function(e){return e?(o.isOBJ(e)?e.level=20:e={msg:e,level:20},m.push(e),m):m},init:function(e){if(o.isOBJ(e))for(var i in e)n[i]=e[i];var r=parseInt(n.id,10);return r&&(/qq\.com$/gi.test(location.hostname)&&(n.url||(n.url="//badjs2.qq.com/badjs"),n.uin||(n.uin=parseInt((document.cookie.match(/\buin=\D+(\d+)/)||[])[1],10))),n._reportUrl=(n.url||"/badjs")+"?id="+r+"&uin="+n.uin+"&"),t.length&&g(),a._initing||(a._initing=!0,a.ready(function(e,t){t&&setTimeout(function(){t.clearDB(n.offlineLogExp),setTimeout(function(){n.offlineLogAuto&&d()},5e3)},1e3)})),m},__onerror__:e.onerror};return"undefined"!=typeof console&&console.error&&setTimeout(function(){((location.hash||"").match(/([#&])BJ_ERROR=([^&$]+)/)||[])[2]},0),m}(window);"undefined"!=typeof module&&(module.exports=Re);var Me,Pe=(function(){BJ_REPORT.init({id:1,combo:0,url:"//badjs.qidian.qq.com/badjs",level:2})}(),i()),Le=function(e){var t=/uc_msg|oppo_night|weibo|msfapi|axure/i,i=Object.prototype.toString;return!e||"[object String]"!==i.call(e)||t.test(e)?!1:e},De=function(){function e(e,t){a(e,"message",function(e){var a=Le(e.data);if(a){-1==a.indexOf(n)&&BJ_REPORT&&BJ_REPORT.report("PM NO Flag "+a);try{i=JSON.parse(a)}catch(e){throw new Error("PostMsg Parse Error "+a)}"function"==typeof t?t(i):""}},!1)}function t(e,t){var a=i?$.extend(i,e):e,r=t||o;a.hasOwnProperty(n)&&a[n]==r||(a[n]=r),a="string"!=typeof a?JSON.stringify(a):a,window.top.postMessage(a,"*")}var i,n="QD_PM",o="CHAT";return{receive:e,send:t}}(),xe=function(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;").replace(/=/g,"&#61;").replace(/`/g,"&#96;")},qe=function(e,t){var i=/<%=(.+?)%>/g,n={}.toString;return e.replace(i,function(e,i){return"="===i.substring(0,1)?"[object Object]"==n.call(t,null)?t[i.substring(1)]:t:t[i]?xe("[object Object]"==n.call(t,null)?t[i]:t):""})},Ae=document,Ne=function(){function e(e){return e in a?a[e]:!1}function t(e,t){return a[e]=t,!0}function i(e){var t=e in a;return t?delete a[e]:!1}function n(){return a={},!0}var a={};return{type:"memory",getItem:e,setItem:t,removeItem:i,clear:n}},Ge=function(e){function t(e){return o.getItem(e)}function i(e,t){try{return o.setItem(e,t),!0}catch(i){return!1}}function n(e){return o.removeItem(e)}function a(){return o.clear()}var o=Ne();try{"localStorage"in e&&e.localStorage&&(e.localStorage.setItem("test","test"),e.localStorage.removeItem("test"),o=e.localStorage)}catch(r){BJ_REPORT&&BJ_REPORT.report(JSON.stringify(r))}return{type:o.type,get:t,set:i,remove:n,clear:a}}(window),$e=function(){function e(e,t){return e+""+t}function t(e){return 14==e.length?!0:!1}function i(e){return t(e)?e.substr(-1,1):e}function n(e){return t(e)?e.substr(0,13):e}return{setType:e,getType:i,getBody:n}}(),Ue=function(){function e(e){o=Ee.receptionist,t()}function t(){var e=JSON.parse(Ge.get("config")),t="kf"+o.kfUin,n=JSON.parse(Ge.get(t)),a=+new Date,r={visitorId:o.visitorId,startTime:a,total:0},s=!1;e?i():Ge.set("config",JSON.stringify({name:we.MSG_DB_OPTS.NAME,version:we.MSG_DB_OPTS.CURRENT_VERSION,createTime:a})),n?(n.forEach(function(e){e.visitorId==r.visitorId&&(s=!0)}),s||(n.push(r),Ge.set(t,JSON.stringify(n)),s=!0)):(Ge.set(t,JSON.stringify([r])),Ge.set(Ee.seqs.key,JSON.stringify([]))),!Ge.get(Ee.seqs.key)&&Ge.set(Ee.seqs.key,JSON.stringify([]))}function i(){var e,t,i,a=Ge.get("config");if(~a.indexOf("verison")&&(BJ_REPORT.report("Wrong Word verison"),a=a.replace(/verison/g,"version"),Ge.set("config",a)),e=JSON.parse(a),t=e.version,"1.0.0"==t&&($.extend(e,{version:1,updateAct:{name:"reName",time:+new Date}}),Ge.set("config",JSON.stringify(e))),i=we.MSG_DB_OPTS.CURRENT_VERSION-t,i>0){for(var o=0;i>o;o++)n(o+t+1);$.extend(e,{version:we.MSG_DB_OPTS.CURRENT_VERSION,updateAct:{name:"update",time:+new Date}}),Ge.set("config",JSON.stringify(e))}}function n(e){var t="kf"+o.kfUin,i=JSON.parse(Ge.get(t));switch(e){case 2:for(var n=0;n<i.length;n++){var a=i[n].visitorId,r=i[n].total;if(a==o.visitorId&&r>0)for(var s=0;r>s;s++){var c=t+"vId"+a+"index"+s,l=JSON.parse(Ge.get(c));$.extend(l,{type:1}),Ge.set(c,JSON.stringify(l))}}break;case 3:$.isArray(i)||(i=[{visitorId:o.visitorId,total:0}],BJ_REPORT.report("Msgdb Update Error "+JSON.stringify(i)));for(var n=0;n<i.length;n++){var a=i[n].visitorId,r=i[n].total;if(a==o.visitorId&&r>0)for(var d=t+"vId"+a+"seqs",u=[],s=0;r>s;s++)u.push(s),Ge.set(d,JSON.stringify(u))}}}function a(e,t,i){var n,a=o.kfUin,r=o.visitorId,s=t["b2c"==e?"sortseq":"date"]+""+t.type,c="kf"+a+"vId"+r+"index"+s,l=Ee.c2bDBsaveData,u=Ee.seqs.data,p={};if(u&&$.isArray(u)||(Ee.seqs.data=u=[],Ge.set(Ee.seqs.key,JSON.stringify(u))),"b2c"==e){if(p={data:t.data,type:t.type,seq:t.seq,time:t.date},!i.singleSeqs)throw new Error("not sortSeqs");n=i.singleSeqs,3!=t.type&&$.extend(p,{dir:e,avatar:t.avatar,name:t.name}),5==t.type&&$.extend(p,{tpl:t.tpl,msgType:t.msgType,simple:t.simple,method:""}),"insert"==i.act?u.splice(i.index,0,i.singleSeqs):u.push(i.singleSeqs)}else{for(var f=0,g=l.length;g>f;f++){var m=l[f];if(m.seq==t.seq){$.extend(p,m,t),p.time=p.date,p.dir=e,delete p.date,l.splice(f,1),Ee.c2bDBsaveData=l;break}}2==p.type&&(p.data=p.imgSrc.replace(/\/0$/g,"/720"),delete p.imgSrc),u.push(t.singleSeqs),n=t.singleSeqs}"undefined"!=typeof p.data.tpl&&delete p.data.tpl,Ge.set(c,JSON.stringify(p)),s++,d(a,r,"set"),Ee.seqs.data=u,Ge.set(Ee.seqs.key,JSON.stringify(u)),BJ_REPORT.report("Msg Dir "+e+" Seqs "+("b2c"==e?$e.setType(t.sortseq-Ee.serverClientTimeDiff,t.type):n))}var o={};return{initialize:e,saveMsg:a}},Be=Ue(),He=[14,1,2,3,4,5,6,7,8,9,10,11,12,13,0,15,16,96,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,89,113,114,115,60,61,46,63,64,116,66,67,53,54,55,56,57,117,59,75,74,69,49,76,77,78,79,118,119,120,121,122,123,124,42,85,43,41,86,125,126,127,128,129,130,131,132,133,134,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,135,17,40,44,45,58,47,48,50,51,52,68,70,71,72,73,80,81,82,83,84,87,88,90,91,92,93,94,95,62,65,172,182,179,173,174,212,175,178,177,180,181,176,183,171,188,192,184,185,190,187,193,194,197,198,199,200,201,202,203,204,205,206,207,208,210,211],Fe=["微笑","撇嘴","色","发呆","得意","流泪","害羞","闭嘴","睡","大哭","尴尬","发怒","调皮","呲牙","惊讶","难过","酷","冷汗","抓狂","吐","偷笑","可爱","白眼","傲慢","饥饿","困","惊恐","流汗","憨笑","大兵","奋斗","咒骂","疑问","嘘...","晕","折磨","衰","骷髅","敲打","再见","擦汗","抠鼻","鼓掌","糗大了","坏笑","左哼哼","右哼哼","哈欠","鄙视","委屈","快哭了","阴险","亲亲","吓","可怜","菜刀","西瓜","啤酒","篮球","乒乓","咖啡","饭","猪头","玫瑰","凋谢","示爱","爱心","心碎","蛋糕","闪电","炸弹","刀","足球","瓢虫","便便","月亮","太阳","礼物","拥抱","强","弱","握手","胜利","抱拳","勾引","拳头","差劲","爱你","NO","OK","爱情","飞吻","跳跳","发抖","怄火","转圈","磕头","回头","跳绳","挥手","激动","街舞","献吻","左太极","右太极","双喜","鞭炮","灯笼","发财","K歌","购物","邮件","帅","喝彩","祈祷","爆筋","棒棒糖","喝奶","下面","香蕉","飞机","开车","高铁左车头","车厢","高铁右车头","多云","下雨","钞票","熊猫","灯泡","风车","闹钟","大伞","彩球","钻戒","沙发","纸巾","药","手枪","青蛙"],Je={index:He,humen:Fe},je=function(e,t){var i,n,e=e?e:window.location.href;if(t){i=new RegExp("[?&]"+t+"=([^&#]*)","i");
try{n=i.exec(e)[1]}catch(a){n=null}}else n=e.substring(e.indexOf("?")+1);return n},We=function(e){var t,i,n=$.extend(!0,{},Ee.getSigTData),a=Ee.isInIframe,o="mqq"===Ee.inWebViewType?!0:!1;Ee.isMobile?a?(e=e.replace(/\+/gi,"%2B"),window.top.postMessage({act:"LAUNCH",type:"PHONE",sign:e,protocol:we.CGI_URL.ROUTE_CHANGE_LOADING.QQ+"?fromWebIm=1&"+$.param(n)+"&protocol="+e},"*")):o?top.location.href=e:top.location.href=we.CGI_URL.ROUTE_CHANGE_LOADING.QQ+"?"+je(window.location.href)+"&protocol="+e:"https"===window.location.protocol&&-1===Ee.userAgent.indexOf("msie")?window.location.href=e:(t=document.createElement("iframe"),i=document.body,t.style.display="none",i.insertBefore(t,i.firstChild),t.src=e)},Ke=function(){function e(){Ee.clientPingTimer||(Ee.clientPingTimer=setInterval(function(){Ee.chatSocket.emitMsg(we.SOCKET_CMD.CLIENT_PING.EMIT,{})},n))}function t(){Ee.clientPingTimer&&(clearInterval(Ee.clientPingTimer),Ee.clientPingTimer=null)}function i(){t(),e()}var n=we.SOCKET_OPTS.CLIENT_PING_DELAY;return{add:e,remove:t,update:i}}(),Ve=[],Qe=function(e){var t=[],i=+new Date,n="log_"+i,a=t[n]=new Image;return a.onload=a.onerror=function(){t[n]=null},e+=(e.indexOf("?")>-1?"&":"?")+i,a.src=e,arguments},ze=function(e){var t="https://fereport.qidian.qq.com/report/webim?",i=t+$.param($.extend({},e,{visitorid:Ee.receptionist.visitorId,kfuin:Ee.receptionist.kfUin,tid:1000001,count:1}));Qe(i)},Ye=function(){function e(e,t,i){var n={},a=0,o=0;$.ajax({url:we.CGI_URL.GET_MENU_URL,data:e,type:"POST",timeout:3e3,dataType:"json",error:function(t,n,a){i.trigger("fail",{textStatus:n,errorThrown:a,queryData:e})},beforeSend:function(){o=+new Date},complete:function(){ze({type:5,requestConsumTime:+new Date-o,clickid:Ee.getSigTData.clickid,addon:JSON.stringify({menuKey:e.navKey})})},success:function(e){0!=e.r?i.trigger("fail",e):($.extend(n,{config:e.data.navSet.config,eLogo:e.data.eLogo||we.CGI_URL.COMP_SOURCE_URL+"img/default-logo.png",eName:e.data.eName,version:e.data.version},e.data.navSet.content),$.extend(s,{currentVersion:parseInt(n.version),eLogo:n.eLogo,eName:n.eName}),"undefined"!=typeof n["default"].action&&(a=parseInt(n["default"].manualType),$.extend(s.defaultConfig,{active:parseInt(n["default"].action),roleValue:a,roleData:0===a?parseInt(n["default"].serviceKfext):parseInt(n["default"].groupId)}),Ee.isRealSendMsg=s.defaultConfig.active,s.defaultConfig.active&&($.extend(Ee.getSigTData,{roleValue:s.defaultConfig.roleValue,roleData:s.defaultConfig.roleData}),Ee.ioLinkStatus="over")),$.extend(Ee.menuDetail,s),c.msg(n,i))}})}function t(e){var t,n=e,a={};n.delegate("a","click",function(e){e.preventDefault(),t=$(e.currentTarget);var o=t.parent().parent(),r=o.children().eq(0),c=o.children().eq(1),l=r.find("i"),d=n.data("openIndex")||0,u=o.index(),p=+new Date+Ee.serverClientTimeDiff;switch(a={action:parseInt(t.data("action")),type:t.data("replytype"),data:t.data("replydata")},d&&u!=d&&t.closest(".nav-hd").length&&(Ee.isMobile?n.find(".nav-item").eq(d-1).children().eq(1).css("height",0).prev().find("i").removeClass("up").addClass("down"):n.find(".nav-item").eq(d-1).children().eq(1).slideUp("fast").end().find("i").removeClass("icon-arrow-up").addClass("icon-arrow-down")),a.action){case 1:lt.normal.render("b2c",{avatar:s.eLogo,name:s.eName,data:a.data,date:p,type:3===a.type?5:a.type,isNavGet:3===a.type?!0:!1,sortseq:p},"autoReply",!0,{act:"append",singleSeqs:p+""+(3===a.type?5:a.type)},!1,!0);break;case 2:b(a.data);break;case 3:Ee.inRegProcess||($.extend(Ee.getSigTData,{kfuin:i.kfUin,roleValue:a.type,roleData:a.data}),delete Ee.wpaDetail.extUin,K(Ee.getSigTData,null,null,!0));break;case 4:Ee.isMobile?"0px"==c.css("height")?(n.data("openIndex",u),l.addClass("up"),c.css("height",46*c.find("li").length+"px")):(n.removeData("openIndex"),l.removeClass("up"),c.css("height","0px")):(c.css("display")&&"none"!=c.css("display")?(l.removeClass("icon-arrow-up").addClass("icon-arrow-down"),n.removeData("openIndex")):(l.removeClass("icon-arrow-down").addClass("icon-arrow-up"),n.data("openIndex",u)),c.slideToggle("fast"));break;default:BJ_REPORT.report("Menu Action Type Error"+a.action)}}),n.on("expired",function(){$(this).attr("data-oldver",1).addClass("menu-expired").children().append(we.CHAT_MSG_TPL.menuMsgExpired)})}var i=Ee.receptionist,a=Ee.wpaDetail,s=Ee.menuDetail,c=(Ee.inRegProcess,Ee.chatSocket,{start:function(t,n){var o={visitorId:i.visitorId,wpaId:a.wpaId,kfuin:i.kfUin,navKey:t.menuKey},s={loading:we.VIEW_OPTS.MENU_MSG.LOADING,fail:we.VIEW_OPTS.MENU_MSG.FAIL},c=e;t.isNewNav&&(r({type:"msgExpired",act:"new"}),this.expired()),this.load(null,o,s,c)},load:function(e,t,i,a){var o=$(qe(we.CHAT_MSG_TPL.msgLoad.loading,i.loading)),r=$('[data-guid="'+e+'"]').prev();o.data("queryData",t),e?o.insertBefore(r):Ie.chatListWrap.append(o),r=o,o.on("fail",function(e,s){o.html(qe(we.CHAT_MSG_TPL.msgLoad.getMsg,i.fail)).find(".btn-load-msg").one(Ee.clickName,function(){o.trigger("loading"),a&&a(t,r,o)}),n(),BJ_REPORT.report("Menu GetData Error"),BJ_REPORT.report(JSON.stringify(s))}).on("loading",function(){o.html(qe(we.CHAT_MSG_TPL.msgLoad.loading,i.loading))}).on("success",function(){o.remove()}).on("over",function(){o.html(qe(we.CHAT_MSG_TPL.msgLoad.overTip,i.over))}),a&&a(t,r,o)},expired:function(){Ie.chatListWrap.find('.mod-menu[data-oldver="0"]').each(function(){$(this).trigger("expired")})},msg:function(e,i){var a=0;e.button&&(a=(100/e.button.length).toFixed(2),$.extend(e,{buttonWidth:a})),Be.saveMsg("b2c",{data:e,type:3,date:Ee.receptionist.time,sortseq:Ee.receptionist.time},{act:"append",singleSeqs:Ee.receptionist.time+"3"}),$.extend(e,{isMobile:Ee.isMobile,currentVersion:s.currentVersion,guid:o(we.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP)}),T(Ee.receptionist.time),Ie.chatListWrap.append($.tmpl(we.CHAT_MSG_TPL.menuMsgNormal,e)),i.trigger("success"),n(),t($('[data-guid="'+e.guid+'"]'))}});return{render:c,bindEvents:t}},Xe=new RegExp("((?:(http|https|Http|Https|rtsp|Rtsp):\\/\\/(?:(?:[a-zA-Z0-9\\$\\-\\_\\.\\+\\!\\*\\'\\(\\)\\,\\;\\?\\&\\=]|(?:\\%[a-fA-F0-9]{2})){1,64}(?:\\:(?:[a-zA-Z0-9\\$\\-\\_\\.\\+\\!\\*\\'\\(\\)\\,\\;\\?\\&\\=]|(?:\\%[a-fA-F0-9]{2})){1,25})?\\@)?)?((?:(?:[a-zA-Z0-9][a-zA-Z0-9\\-]{0,64}\\.)+(?:(?:aero|arpa|asia|a[cdefgilmnoqrstuwxz])|(?:biz|b[abdefghijmnorstvwyz])|(?:cat|com|coop|club|c[acdfghiklmnoruvxyz])|d[ejkmoz]|(?:edu|e[cegrstu])|fun|f[ijkmor]|group|(?:gov|g[abdefghilmnpqrstuwy])|h[kmnrtu]|(?:info|int|ink|i[delmnoqrst])|(?:jobs|j[emop])|kim|k[eghimnrwyz]|ltd|link|l[abcikrstuvy]|(?:mil|mobi|museum|m[acdghklmnopqrstuvwxyz])|(?:name|net|n[acefgilopruz])|(?:org|online|om)|(?:pro|p[aefghklmnrstwy])|qa|red|ren|r[eouw]|store|site|shop|s[abcdeghijklmnortuvyz]|(?:tel|travel|top|tech|t[cdfghjklmnoprtvwz])|u[agkmsyz]|vip|v[aceginu]|xin|xyz|wang|work|w[fs]|y[etu]|z[amw]))|(?:(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[1-9])\\.(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[1-9]|0)\\.(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[1-9]|0)\\.(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[0-9])))(?:\\:\\d{1,5})?)(\\/(?:(?:[a-zA-Z0-9\\;\\/\\?\\:\\@\\&\\=\\#\\~\\-\\.\\+\\!\\*\\'\\(\\)\\,\\_])|(?:\\%[a-fA-F0-9]{2}))*)?(?:\\b|$)","gi"),Ze=function(e,t,i){var n=t||"http(s)?",a=i||"http://",o=new RegExp("^("+n+"):\\/\\/","gi");return e.match(o)?e:a+e},et={get:function(e){var t="kf"+e.kfUin+"vId"+e.visitorId+"red",i=JSON.parse(Ge.get(t)),n="wId"+e.wpaId,a={};return i&&i.forEach(function(e){e[n]&&(a=e[n])}),a},set:function(e,t,i){var n,a=arguments.length<=3||void 0===arguments[3]?!0:arguments[3],o="kf"+e.kfUin+"vId"+e.visitorId+"red",t="wId"+t,r=JSON.parse(Ge.get(o)),s=!1,c={name:e.name,number:1},l={},d=c.number;r?(r.forEach(function(i){for(n in i)n==t&&(s=!0,d=i[n].number+1,i[n].number=d,i[n].name=e.name)}),s||(l[t]=c,r.push(l)),a&&Ge.set(o,JSON.stringify(r))):(l[t]=c,Ge.set(o,JSON.stringify([l]))),!Ee.isMobile&&et.render("update",d),i&&i(d)},reset:function(e){var t,i="kf"+e.kfUin+"vId"+e.visitorId+"red",n=JSON.parse(Ge.get(i)),a=[];n&&(n.forEach(function(e){for(t in e){var i={};i[t]={number:0},a.push(i)}}),Ge.set(i,JSON.stringify(a)))},render:function(e,t,i){var n={page:$(".page"),unReadMsgNum:$(".unread-msg-num")},a=n.unReadMsgNum.parent().find(".name"),o=n.unReadMsgNum.parent().find(".status");0!=t&&("update"==e?(n.unReadMsgNum.hasClass("hidden")&&n.unReadMsgNum.removeClass("hidden"),n.unReadMsgNum.text(t>9?"9+":t)):"reset"==e&&n.unReadMsgNum.addClass("hidden").text(""),i&&(n.page.removeClass("page-inframe").addClass("page-minify"),a.text(i.name),o.text(i.status)))}},tt=function(e){for(var t=450,i=e.length,n=parseInt(i/t,10),n=i%t!==0?n+1:n,a=0;n>a;a++)BJ_REPORT.report("Seqs Sheet "+e.substr(t*a,t))},it=function(e){"undefined"!=typeof e.c_info&&!e.c_info.name&&$.extend(Ee.receptionist,{corpName:e.c_info.name}),$.extend(Ee.receptionist,{extUin:e.u_info.uin,name:e.u_info.name,avatar:e.u_info.face||Ee.defaultAvatar,resign:e.u_info.position,qq:e.u_info.qq,time:e.date})},nt=function(e){this.options={command:"copy",events:{}};return $.extend(!0,this.options,e),"undefined"==typeof e.data?void this.fail(0):void this.execCopy()};nt.prototype.isSupport=function(){var e=!!document.queryCommandSupported;return e=e&&!!document.queryCommandSupported(this.options.command)},nt.prototype.createElement=function(){var e=+new Date,t="clipboard-target-"+e;return $("body").append('<span class="'+t+'" style="position:absolute;z-index:-1;font-size:0;"></span>'),$("."+t)},nt.prototype.destoryElement=function(e){e&&e.remove()},nt.prototype.fail=function(e,t){this.options.events.fail&&this.options.events.fail(e,t)},nt.prototype.selectText=function(e){var t,i=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),i.removeAllRanges(),i.addRange(n),t=i.toString()},nt.prototype.execCopy=function(){var e,t,i=this.isSupport();if(i){if(e=this.createElement(),e.html(this.options.data),t=this.selectText(e.get(0)),0==t.length)return void(this.options.events.fail&&this.options.events.fail(1));try{document.execCommand(this.options.command),this.options.events.success&&this.options.events.success()}catch(n){this.options.events.fail&&this.options.events.fail(3,n)}this.destoryElement(e)}else this.options.events.fail&&this.options.events.fail(2)};var at={waitRetDelayTime:15e3,waitRetQueue:{},waitRetManage:{add:function(e){var t="kfAccount"+e.kfAccount;at.waitRetQueue[t]=setTimeout(function(){at.renderRet({ret:"fail",kfAccount:e.qqNumForPaste}),at.waitRetManage.destory(e)},at.waitRetDelayTime)},remove:function(e){var t="kfAccount"+e.kfAccount;at.waitRetQueue.hasOwnProperty(t)&&clearTimeout(at.waitRetQueue[t]),at.waitRetManage.destory(e)},destory:function(e){var t="kfAccount"+e.kfAccount;at.waitRetQueue.hasOwnProperty(t)&&delete at.waitRetQueue[t]}},getData:function(e,t){var i=$(t.target).parents(".content").find("dd a").html();p({text:"正在获取添加协议"},500),$.ajax({url:we.CGI_URL.GET_ADD_FRIEND_SCHEME,data:{kfext:Ee.receptionist.extUin,kfuin:Ee.receptionist.kfUin,visitorId:Ee.receptionist.visitorId,ftype:Ee.isMobile,kfaccount:e,clickid:be()},type:"GET",timeout:2e3,dataType:"jsonp",jsonp:"cb",error:function(){at.renderRet({ret:"fail",kfAccount:i})},success:function(e){var t,n=e.r;0==n&&"undefined"!=typeof e.data.sign?(t=e.data.sign,We(t)):at.renderRet({ret:"fail",extUin:i})}})},renderRet:function(e){var t=+new Date,i=e.kfAccount;"undefined"!=typeof e.originData&&Ee.chatSocket.emitMsg(we.SOCKET_CMD.SESSION_MSG.EMIT,{csrf:e.originData.csrf,seq:e.originData.seq,type:e.originData.type,time:e.originData.time}),"fail"==e.ret?(r({type:"addFriendFail",act:"new",seq:t}),$('[data-guid="'+t+'"]').find(".btn-paste").on("click",function(){new nt({data:i,events:{success:function(){p({text:"复制成功"},1e3)},fail:function(e,t){var i;switch(e){case 0:i="失败：获取号码数据失败";break;case 1:i="失败：没有选中文字，请手工复制";break;case 2:i="失败：浏览器不支持，请手工复制";break;default:i="失败："+t}p({text:i},1e3)}}})})):at.waitRetManage.remove({kfAccount:i})}},ot={sendAck:function(e){Ee.chatSocket.emitMsg(we.SOCKET_CMD.SESSION_MSG.EMIT,{csrf:e.csrf,seq:e.seq,type:e.type,time:e.time})},render:function(e,t,i){var n,a=e.sortseq||e.time,r=e.data,s=i.msgName||e.data.msgName,c=i.isNeedStore?"msg":"welcome",l="undefined"!=typeof i.isFromHistory?i.isFromHistory:!1,d=i.isNeedStore?!1:!0,u=l?{act:"prepend",singleSeqs:a+"4"}:{act:"append",singleSeqs:a+"4"},p=$e.setType(a,4);i.isNeedAck&&ot.sendAck(e),n=i.isNeedWrap?$.tmpl.joinTpl(we.CHAT_MSG_TPL[t+"Wrap"],"msgContent",we.RICH_MSG_TPL[r.type]):we.RICH_MSG_TPL[r.type],$.extend(r,{msgName:s,msgType:"msg-rich",isNeedWrap:i.isNeedWrap,tpl:n,seq:a}),i.isNeedStore&&(d=w(p),u=E(p)),d&&(lt.normal.render(t,{data:r,seq:o(we.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),type:4,wordMsgSeq:o(we.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PC),date:a,sortseq:a},c,!0,u,!1),"addfriend"==s&&!Ee.isMobile&&$('[data-guid="'+a+'"]').find("h2.title").prepend('<i class="icon-qq"></i>'),ot.bindEvent(a,r))},bindEvent:function(e,t){$('[data-guid="'+e+'"]').delegate("a","click",function(e){var i=$(e.currentTarget),n=i.attr("action"),a=i.attr("url"),r=i.attr("actionData"),s=o(we.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP);switch(e.preventDefault(),n){case"web":b(a);break;case"msg":$.extend(t,{tpl:$.tmpl.joinTpl(we.CHAT_MSG_TPL[r+"Wrap"],"msgContent",we.RICH_MSG_TPL[t.type]),seq:s}),0==t.type&&$.extend(t,{isNeedWrap:!0}),lt.normal.render(r,{data:t,seq:s,type:4,wordMsgSeq:o(we.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PC),date:+new Date+Ee.serverClientTimeDiff},"msg",!0),0==t.type&&ot.bindEvent(s,t);break;case"addFriend":at.getData(r,e);break;default:BJ_REPORT.report("RichMsg Action Error"+n)}})}},rt={render:function(e,t){if(Ie.chatListWrap.off("graphicMsgLoad").on("graphicMsgLoad",function(e,t){rt._bindEvent(t)}),e.isNavGet)return rt.download(e),null;var i;return t.isFromHistory||(e=rt._processData(e)),i=$($.tmpl(e.tpl,e))},download:function(e){return $.ajax({url:we.CGI_URL.GET_GRAPHIC_MSG,data:{materialId:e.data,kfuin:Ee.receptionist.kfUin},type:"POST",timeout:3e3,dataType:"json",error:function(t,i,n){r({type:"graphicMsgFail",seq:o(e.sortseq),act:"new"})},success:function(t){if(0!=t.r)return null;var i=$e.setType(e.sortseq,e.type),n=E(i);$.extend(e,{data:t.data,method:"",seq:i,isNavGet:!1}),lt.normal.render("b2c",e,"msg",null,n,!1,!1)}}),e},_processData:function(e){var t=[],i={},n=!0;return e.data=JSON.parse(e.data),e.data&&e.data.item&&(e.data.item=e.data.item.filter(function(e){return!e[0]&&!e.more})),n=e.data.item&&1==e.data.item.length,e.data.item&&e.data.item.forEach(function(a,o){a.title&&(i.title=a.title),a.picture&&a.picture["@attributes"].cover&&(i.cover=a.picture["@attributes"].cover),n?(a.summary&&(i.summary=a.summary[1],i.date=a.summary[0]),i.url=e.data["@attributes"].url):i.url=a["@attributes"].url,t.push(i),i={}}),$.extend(e,{data:t,msgType:"msg-graphic",simple:n}),e.tpl=$.tmpl.joinTpl(we.CHAT_MSG_TPL.b2cWrap,"msgContent",we.RICH_MSG_TPL[2][n?"simple":"multiple"]),e},_bindEvent:function(e){$('[data-guid="'+e.seq+'"]').delegate(e.simple?".content.simple":".thumb",Ee.isMobile?"tap":"click",function(e){var t=$(e.currentTarget),i=t.attr("action"),n=t.attr("actionData");switch(e.preventDefault(),i){case"web":b(n);break;default:BJ_REPORT.report(" Action Error"+i)}})}},st=function(e){var t={title:document.title,message:"你有【新消息】",dynamicTitle:!1,interval:200};this.opts=$.extend({},t,e),this.opts.dynamicTitle&&delete this.opts.title};st.prototype={changeTitle:function(){document.title=this.opts.title===document.title?this.opts.message:this.opts.title},addTimer:function(){var e=this;return"undefined"==typeof this.timer&&(this.timer=setInterval(function(){e.changeTitle()},this.opts.interval)),this},clearTimer:function(){return this.timer&&(clearInterval(this.timer),delete this.timer,document.title=this.opts.title),this},setTitle:function(){return this.opts.dynamicTitle&&"undefined"==typeof this.opts.title&&(this.opts.title=document.title),this},twinkling:function(){this.setTitle().addTimer()}};var ct=C(),lt={historyMsg:D(),normal:x(),image:q(),renderUploadImgRet:O},dt=(function(){var e=i(),t=0,n=window.navigator.userAgent,a=0;return"iOS"==e&&n.match(/OS(.*?)like/i)&&(t=n.match(/OS(.*?)like/i)[1].trim().replace(/_/g,function(){return a++,1==a?".":""})),parseFloat(t)}(),function(){function e(e,t,i){$.ajax({url:we.CGI_URL.GET_OFFLINE_MSG,data:e,type:"POST",timeout:3e3,dataType:"json",error:function(){i.trigger("fail")},success:function(e){"undefined"!=typeof e&&"undefined"!=typeof e.code&&0==e.code?o.msg(e,t,i):i.trigger("fail")}})}var i=Ee.receptionist,a=(Ee.wpaDetail,Ee.mobileSysType),o={load:function(t,a){var o=$(qe(we.CHAT_MSG_TPL.msgLoad.loading,we.VIEW_OPTS.OFFLINE_MSG.LOADING)),r=t.body.offlineMsgNum,s=(we.VIEW_OPTS.OFFLINE_MSG.PER_NUM,{visitorId:i.visitorId,kfext:t.body.offlineUin,kfuin:i.kfUin,key:t.body.offlineMsgKey,start:0,num:r}),c=$('[data-guid="'+a+'"]').prev();o.data("queryData",s),a?o.insertBefore(c):Ie.chatListWrap.append(o),c=o,o.on("fail",function(){o.html(qe(we.CHAT_MSG_TPL.msgLoad.getMsg,we.VIEW_OPTS.OFFLINE_MSG.FAIL)).find(".btn-load-msg").one(Ee.clickName,function(){o.trigger("loading"),e(s,c,o)}),n()}).on("loading",function(){o.html(qe(we.CHAT_MSG_TPL.msgLoad.loading,we.VIEW_OPTS.OFFLINE_MSG.LOADING))}).on("over",function(){o.html(qe(we.CHAT_MSG_TPL.msgLoad.overTip,we.VIEW_OPTS.OFFLINE_MSG.OVER))}),e(s,c,o)},msg:function(e,i,o){for(var r,s=this,c=e.rowDatas,l=o.data("queryData"),d={},u=c.length-1;u>=0;u--)$.extend(d,c[u],{avatar:e.kfInfo.face,name:e.kfInfo.name}),lt.normal.conventSigle("b2c",d).insertAfter(i),$(qe(we.CHAT_MSG_TPL.time,y(d.date))).insertAfter(i),Be.saveMsg("b2c",d);o.trigger("over"),n(),o[0].getBoundingClientRect().top<45&&(t("第一条离线消息没有看到"),r="Android"==a?Ie.modList:Ie.chatListWrap,s.tip(l.num,"show",o[0].offsetTop),r.on("scroll",function(){o[0].getBoundingClientRect().top>=45&&(s.tip(l.num,"hide"),r.off("scroll"))}))},tip:function(e,t,i){var n=$(qe(we.CHAT_MSG_TPL.msgLoad.numTip,e));Ie.chatList.append(n),"hide"==t?Ie.chatList.find(".btn-offlinemsg-gotop").remove():n.on(Ee.clickName,function(){Ie.chatListWrap[0].scrollTop=i,n.remove()})}};return{render:o}}()),ut=function(){function e(e){$.extend(o,e),t()}function t(){var e=o.data;e.fbKey;d.emitMsg(we.SOCKET_CMD.SESSION_MSG.EMIT,{csrf:o.csrf,seq:o.seq,type:o.type,time:o.time}),$.extend(e,{hasDesc:2==e.style?!0:!1,isMobile:Ee.isMobile},we.FB_OPTS),Ie.chatListWrap.append($.tmpl(we.CHAT_MSG_TPL.feedback,e)),n(),i(e)}function i(e){var t,i,n,o=e.hasDesc,s=e.fbKey,c={avail:we.FB_OPTS.availLetterSum,used:0,remain:we.FB_OPTS.availLetterSum},d={},u=0,f=0,g=we.FB_OPTS.delayTime,m=$('[data-fbkey="'+s+'"]'),h=m.find(".fb-level a"),v=m.find(".fb-desc"),S=m.find(".post-text").children().eq(0),y=m.find(".fb-loading");m.data("extUin",e.extUin),Object.defineProperty(d,"seq",{value:e.seq}),Object.defineProperty(d,"level",{set:function(e){var t=e+1;m.data("level",t).find(".level-desc").text(h.eq(e).data("desc")),!o&&m.trigger("loading")},get:function(){return m.data("level")}}),Object.defineProperty(d,"desc",{set:function(e){f=1,m.data("desc",e).trigger("loading")},get:function(){return m.data("desc")}}),!l&&h.hover(function(){for(var e=0;e<=$(this).index();e++)h.eq(e).addClass("on")},function(){for(var e=0;e<=$(this).index();e++)h.eq(e).removeClass("on")}),h.on(Ee.clickName,function(){if(!$(this).parent().hasClass("disabled")){u=$(this).index(),d.level=u,h.removeClass("active");for(var e=0;u>=e;e++)h.eq(e).addClass("active");o&&0!=v.length&&"none"==v.css("display")&&(i=m.find(".num").eq(0),n=m.find(".btn-submit").eq(0),t=v.find("textarea").eq(0),v[l?"show":"slideDown"]("fast"),t.on("input keyup",function(e){var t=$(this).val();c.used=$(this).val().length,c.remain=c.avail-c.used,i.text(c.remain),c.remain<=0&&(i.text(0),$(this).val(t.substring(0,c.avail)),e.preventDefault())}),n.on(Ee.clickName,function(){var e=$.trim(t.val());f||(d.desc=e,S.text(e))}))}}),m.on("loading",function(){y.fadeIn("fast"),a(d,m)}).on("success",function(){p({text:"提交成功"},g,function(){y.fadeOut("fast"),h.parent().addClass("disabled"),o&&(n.hide().prev().hide(),S.text().length>0&&S.parent().show()),r({type:"feedBack",act:"new"})})}).on("fail",function(e,t){f=0,p({text:"提交失败："+t},g,function(){y.fadeOut("fast")}),BJ_REPORT.report("FeedBackRet GetData Error")})}function a(e,t){var e=$.extend({},{fbLevel:e.level,fbDesc:e.desc,seq:e.seq,fbKey:t.data("fbkey"),visitorId:s.visitorId,kfuin:s.kfUin,extUin:t.data("extUin"),wpaId:c.wpaId,session_time:s.time});$.ajax({url:we.CGI_URL.GET_FEEDBACK_RET,data:e,type:"POST",timeout:3e3,dataType:"json",error:function(i,n,a){t.trigger("fail","网络错误，请重试"),BJ_REPORT.report(JSON.stringify({textStatus:n,errorThrown:a,queryData:e}))},success:function(e){0!=e.r?(t.trigger("fail",e.message),BJ_REPORT.report(JSON.stringify(e))):t.trigger("success")}})}var o={},s=Ee.receptionist,c=Ee.wpaDetail,l=Ee.isMobile,d=Ee.chatSocket;return{initialize:e}},pt=Ee.chatSocket,ft=function(e){var t={timer:"",delay:1e4,consuming:0};return t.timer=setInterval(function(){!e.isGet&&t.consuming<e.timeout?(t.consuming+=t.delay,BJ_REPORT.report(e.text+t.consuming),t.consuming==e.timeout&&e.callback(t.consuming)):clearInterval(t.timer)},t.delay),t.timer},gt=function(){function e(e,t){var n,a={visitorId:d.visitorId,isMobile:Ee.isMobile,wpaKey:u.wpaKey,reception:u.reception,signT:e.sigT,kfuin:d.kfUin,qqUin:l(),wpaId:u.wpaId,key:u.key,invitationType:u.invitationType,extUin:u.extUin,roleValue:e.roleValue,roleData:e.roleData,wpaShowItemId:e.wpaShowItemId,callImType:e.callImType,isChangeKF:Ee.isChangeKF,date:+new Date+Ee.serverClientTimeDiff};Ee.inRegProcess;p.currentVersion&&$.extend(a,{navVersion:p.currentVersion});for(n in a)"undefined"==typeof a[n]&&delete a[n];$.extend(a,{clickid:u.clickid}),i(a)}function t(e,t){var i=3*(we.SOCKET_OPTS.OPTS.ReconnectionAttempts+1)-1;e=t>=i?"reconnectFail":e,r({type:e,seq:Ee.inRegProcess,act:"update"}),Ie.chatBody.hasClass("regsuccess")&&"reconnectFail"==e&&Ie.chatListWrap.find("loading").remove()}function i(e){var i,a={query:"kfuin="+d.kfUin},o=0;S=e.clickid,$.extend(a,Ee.isMobile?{transports:["websocket"]}:{}),i=g.create(we.CGI_URL.SOCKET_CHAT,$.extend(we.SOCKET_OPTS.OPTS,a)),i.emitMsg(we.SOCKET_CMD.REG.EMIT,e,function(){c=ft({isGet:m,timeout:we.SOCKET_OPTS.REG_TIMEOUT,text:"Register Ack Timeout ",callback:function(e){r({type:"regTimeout",empty:!0}),BJ_REPORT.report(this.text)}}),h=+new Date},this).receiveMsg(we.SOCKET_CMD.REG.RECEIVE,n,this,null,!0),i.ioLink.once("connect_error",function(e){BJ_REPORT.report("Connect Error sid "+i.ioLink.id),o++,t("connectError",o)}),i.ioLink.once("reconnecting",function(e){BJ_REPORT.report("Reconnecting sid "+i.ioLink.id),o++,t("reconnectIng",o)}),i.ioLink.once("reconnect_error",function(e){BJ_REPORT.report("Reconnect Error sid "+i.ioLink.id),o++,t("reconnectError",o)}),i.ioLink.once("reconnect_failed",function(e){BJ_REPORT.report("Reconnect Fail sid "+i.ioLink.id),o++,Ee.ioLinkStatus="over",t("reconnectFail",o)}),i.ioLink.once("connect",function(e){o=0,Ee.ioLinkStatus="normal",t("connect")})}function n(e){m=1,c&&clearInterval(c),ze({type:4,requestConsumTime:+new Date-h,clickid:S}),Ee.pageLoadStartTime&&ze({type:7,requestConsumTime:+new Date-Ee.pageLoadStartTime,clickid:S}),"success"==e.result?a(e):o(e)}function a(e){var t;Ee.ioLinkStatus="normal",Ee.isRegOK=1,Ee.seqs.key="kf"+d.kfUin+"vId"+d.visitorId+"seqs",BJ_REPORT.info(Ee.seqs.key),Be.initialize(),delete Ee.wpaDetail.extUin,it(e.body),t=Ge.get(Ee.seqs.key),tt(t),Ee.seqs.data=JSON.parse(t),F(),Ie.chatBody.hasClass("regsuccess")||Ee.regSuccessCallBack&&Ee.regSuccessCallBack(),e.body.update&&r({type:"autoChangeKF",act:"new"}),r({type:"regSuccess",act:"update",seq:Ee.inRegProcess}),Ee.inRegProcess=0,N(e),Ee.isChangeKF="undefined"!=typeof e.body.isChangeKF?e.body.isChangeKF:0,Ee.isChangeKF&&(Ie.chatListWrap.find(".btn-newkf").addClass("disabled"),r({type:"changeKf",seq:Ee.inRegProcess,act:"new"}),$(".msg-sys .btn-newkf").on(Ee.clickName,function(t){J(e,t)})),Ee.reSendC2bMsg&&v("c2b",Ee.reSendC2bMsg,"msg"),Ke.add()}function o(e){var t=e.errmsg||we.SYS_MSG.reReg;BJ_REPORT.report("Register Fail "+JSON.stringify(e)),r({msgType:"serverResp",seq:f,act:"update",data:t}),Ee.inRegProcess=0}function s(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];"sessionOver"!=Ee.ioLinkStatus||Ee.isChangeKF||(delete Ee.wpaDetail.extUin,delete Ee.menuDetail.currentVersion),Ee.isGetSignT=0,m=0,Ee.isInIframe?De.send({act:"SMS_SM_FORCE_CONNECT"}):window.__STATUS_MANAGER.forceConnect(),BJ_REPORT.info("ReConnect"),K(Ee.getSigTData,null,null,e)}var c,d=Ee.receptionist,u=Ee.wpaDetail,p=Ee.menuDetail,f=(Ee.kfChangeTip,Ee.localClickId,Ee.inRegProcess),g=Ee.chatSocket,m=0,h=0,S=0;return{prepareRegData:e,reConnect:s}},mt=function(){function e(){try{var e,t=Date.now();if(sessionStorage.setItem(t,t),e=sessionStorage.getItem(t),sessionStorage.removeItem(t),t!=e)throw new Error;return!0}catch(i){}return!1}function t(t,i){e()?sessionStorage.setItem(t,i):c(t)||s(t,i,null,"/",0)}function i(t){return e()?sessionStorage.getItem(t):c(t)}return{get:i,set:t}}(),ht=$.extend(!0,{},we,{CGI_URL:{GET_SKIN_CORP_INFO:"https://"+__domain.admin+".qidian.qq.com/webim/innerPage/getPCIMInfo"},CHAT_MSG_TPL:{corpInfo:'<div class="mod-desc">\n                    <p class="logo"><img src="<%=o.eLogo%>" width="100" alt="<%=o.eName%>" title="<%=o.eName%>" height="100"/></p>\n                    <p class="name" title="<%=o.eName%>"><%=o.eName%></p>\n                    <div class="desc"><%=o.eDesc%></div>\n                </div>\n                <div class="mod-connect">\n                    <ul>\n                        <% if(o.eAddressDetail) { %><li title="<%=o.eAddressDetail%>"><i class="icon-address"></i><%=o.eAddressDetail%></li><% } %>\n                        <% if(o.eEmail) { %><li><i class="icon-email"></i><a href="mailto:<%=o.eEmail%>" title="<%=o.eEmail%>"><%=o.eEmail%></a></li><% } %>\n                        <% if(o.eHome) { %><li><i class="icon-link"></i><a href="<%=o.eLink%>"  title="<%=o.eHome%>" target="_blank"><%=o.eHome%></a></li><% } %>\n                        <% if(o.ePhone) { %><li><i class="icon-tel"></i><a href="tel:<%=o.ePhone%>" title="<%=o.ePhone%>"><%=o.ePhone%></a></li><% } %>\n                    </ul>\n                </div>'},FLASH_TIP:{NO_FLASH:"请安装flash，发送图片消息需要使用flash",LOW_VERSION:"请升级您的flash版本，现版本太低无法发送图片消息"}}),vt=function(){function e(e){var i=0;$.support.cors=!0,$.ajax({url:ht.CGI_URL.GET_SKIN_CORP_INFO,data:e,type:"POST",timeout:2e3,dataType:"json",error:function(i,n,a){t.fail({textStatus:n,errorThrown:a,queryData:e})},beforeSend:function(){i=+new Date},complete:function(){ze({type:6,requestConsumTime:+new Date-i,clickid:Ee.getSigTData.clickid,addon:JSON.stringify({key:e.key})})},success:function(e){Ee.isGetSkin=1,t[e.code?"fail":"success"](e)}})}var t={skinColor:function(e){var t=["blue","default","orange","red","green"],i="skin-default",n="skin-"+t[e];n!=i&&Oe.page.removeClass(i).addClass(n)},success:function(e){var t=e.corpInfo.eHome;"undefined"!=typeof e.corpInfo.eLogo&&0!=e.corpInfo.eLogo&&e.corpInfo.eLogo||(e.corpInfo.eLogo=ht.CGI_URL.COMP_SOURCE_URL+"img/default-logo.png"),t&&$.extend(e.corpInfo,{eLink:Ze(t)}),this.skinColor(e.theme),$(".sidebar").html($.tmpl(ht.CHAT_MSG_TPL.corpInfo,e.corpInfo))},fail:function(e){$(".sidebar").find("i").remove().end().find(".text").html("企业信息拉取失败"),BJ_REPORT.report("CorpSkin GetData Error"),BJ_REPORT.report(JSON.stringify(e))}};return{getData:e,skinColor:t.skinColor}},St=function Pt(e){function t(){var t=e.reportUrl||o,i=encodeURIComponent("flag1="+d+"&flag2="+u+"&flag3="+p+"&"+m.join("&"));t+="?appid="+r+"&platform="+s+"&app="+c+"&uin="+l+"&speedparams="+i,Qe(t)}var i,n,a,o="//report.huatuo.qq.com/report.cgi",r=20300,s=e.platform||"pc",c=e.app||"other",l=e.uin||null,d=e.flag1,u=e.flag2,p=e.flag3,f=window.performance||window.webkitPerformance||window.msPerformance,g=["navigationStart","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"],m=[],h=null!=e.points&&"[object Object]"==toString.apply(e.points)?e.points:null;if(null!=h){for(var v in h)m.push(v+"="+h[v]);if(0!=m.length)return void t()}if(f&&(i=f.timing)){n=i[g[0]];for(var S=1,y=g.length;y>S;S++)"undefined"!=typeof i[g[S]]&&i[g[S]]>0&&(a=i[g[S]]-n,a>0)?m[S]=S+"="+a:m[S]=S+"=0";t()}e.points&&Pt(e)},yt=V();!function(e,t,i){var n,a,o,r,s,c,l,d,u,p,f,g,m,h,v,S,y,T,b,_,w,E,C,I,O,k,R,M,P,L;E={paneClass:"nano-pane",sliderClass:"nano-slider",contentClass:"nano-content",enabledClass:"has-scrollbar",flashedClass:"flashed",activeClass:"active",iOSNativeScrolling:!1,preventPageScrolling:!1,disableResize:!1,alwaysVisible:!1,flashDelay:1500,sliderMinHeight:20,sliderMaxHeight:null,documentContext:null,windowContext:null},y="scrollbar",S="scroll",d="mousedown",u="mouseenter",p="mousemove",g="mousewheel",f="mouseup",v="resize",r="drag",s="enter",b="up",h="panedown",a="DOMMouseScroll",o="down",_="wheel",c="keydown",l="keyup",T="touchmove",n=null,k=t.requestAnimationFrame,w=t.cancelAnimationFrame,M=i.createElement("div").style,L=function(){var e,t,i,n,a,o;for(n=["t","webkitT","MozT","msT","OT"],e=a=0,o=n.length;o>a;e=++a)if(i=n[e],t=n[e]+"ransform",t in M)return n[e].substr(0,n[e].length-1);return!1}(),P=function(e){return L===!1?!1:""===L?e:L+e.charAt(0).toUpperCase()+e.substr(1)},R=P("transform"),I=R!==!1,C=function(){var e,t,n;return e=i.createElement("div"),t=e.style,t.position="absolute",t.width="100px",t.height="100px",t.overflow=S,t.top="-9999px",i.body.appendChild(e),n=e.offsetWidth-e.clientWidth,i.body.removeChild(e),n},O=function(){var e,i,n;return i=t.navigator.userAgent,(e=/(?=.+Mac OS X)(?=.+Firefox)/.test(i))?(n=/Firefox\/\d{2}\./.exec(i),n&&(n=n[0].replace(/\D+/g,"")),e&&+n>23):!1},m=function(){function c(a,o){this.el=a,this.options=o,n||(n=C()),this.$el=e(this.el),this.doc=e(this.options.documentContext||i),this.win=e(this.options.windowContext||t),this.body=this.doc.find("body"),this.$content=this.$el.children("."+this.options.contentClass),this.$content.attr("tabindex",this.options.tabIndex||0),this.content=this.$content[0],this.previousPosition=0,this.options.iOSNativeScrolling&&null!=this.el.style.WebkitOverflowScrolling?this.nativeScrolling():this.generate(),this.createEvents(),this.addEvents(),this.reset()}return c.prototype.preventScrolling=function(e,t){if(this.isActive)if(e.type===a)(t===o&&e.originalEvent.detail>0||t===b&&e.originalEvent.detail<0)&&e.preventDefault();else if(e.type===g){if(!e.originalEvent||!e.originalEvent.wheelDelta)return;(t===o&&e.originalEvent.wheelDelta<0||t===b&&e.originalEvent.wheelDelta>0)&&e.preventDefault()}},c.prototype.nativeScrolling=function(){this.$content.css({WebkitOverflowScrolling:"touch"}),this.iOSNativeScrolling=!0,this.isActive=!0},c.prototype.updateScrollValues=function(){var e,t;e=this.content,this.maxScrollTop=e.scrollHeight-e.clientHeight,this.prevScrollTop=this.contentScrollTop||0,this.contentScrollTop=e.scrollTop,t=this.contentScrollTop>this.previousPosition?"down":this.contentScrollTop<this.previousPosition?"up":"same",this.previousPosition=this.contentScrollTop,"same"!==t&&this.$el.trigger("update",{position:this.contentScrollTop,maximum:this.maxScrollTop,direction:t}),this.iOSNativeScrolling||(this.maxSliderTop=this.paneHeight-this.sliderHeight,this.sliderTop=0===this.maxScrollTop?0:this.contentScrollTop*this.maxSliderTop/this.maxScrollTop)},c.prototype.setOnScrollStyles=function(){var e;I?(e={},e[R]="translate(0, "+this.sliderTop+"px)"):e={top:this.sliderTop},k?(w&&this.scrollRAF&&w(this.scrollRAF),this.scrollRAF=k(function(t){return function(){return t.scrollRAF=null,t.slider.css(e)}}(this))):this.slider.css(e)},c.prototype.createEvents=function(){this.events={down:function(e){return function(t){return e.isBeingDragged=!0,e.offsetY=t.pageY-e.slider.offset().top,e.slider.is(t.target)||(e.offsetY=0),e.pane.addClass(e.options.activeClass),e.doc.bind(p,e.events[r]).bind(f,e.events[b]),
e.body.bind(u,e.events[s]),!1}}(this),drag:function(e){return function(t){return e.sliderY=t.pageY-e.$el.offset().top-e.paneTop-(e.offsetY||.5*e.sliderHeight),e.scroll(),e.contentScrollTop>=e.maxScrollTop&&e.prevScrollTop!==e.maxScrollTop?e.$el.trigger("scrollend"):0===e.contentScrollTop&&0!==e.prevScrollTop&&e.$el.trigger("scrolltop"),!1}}(this),up:function(e){return function(t){return e.isBeingDragged=!1,e.pane.removeClass(e.options.activeClass),e.doc.unbind(p,e.events[r]).unbind(f,e.events[b]),e.body.unbind(u,e.events[s]),!1}}(this),resize:function(e){return function(t){e.reset()}}(this),panedown:function(e){return function(t){return e.sliderY=(t.offsetY||t.originalEvent.layerY)-.5*e.sliderHeight,e.scroll(),e.events.down(t),!1}}(this),scroll:function(e){return function(t){e.updateScrollValues(),e.isBeingDragged||(e.iOSNativeScrolling||(e.sliderY=e.sliderTop,e.setOnScrollStyles()),null!=t&&(e.contentScrollTop>=e.maxScrollTop?(e.options.preventPageScrolling&&e.preventScrolling(t,o),e.prevScrollTop!==e.maxScrollTop&&e.$el.trigger("scrollend")):0===e.contentScrollTop&&(e.options.preventPageScrolling&&e.preventScrolling(t,b),0!==e.prevScrollTop&&e.$el.trigger("scrolltop"))))}}(this),wheel:function(e){return function(t){var i;if(null!=t)return i=t.delta||t.wheelDelta||t.originalEvent&&t.originalEvent.wheelDelta||-t.detail||t.originalEvent&&-t.originalEvent.detail,i&&(e.sliderY+=-i/3),e.scroll(),!1}}(this),enter:function(e){return function(t){var i;if(e.isBeingDragged)return 1!==(t.buttons||t.which)?(i=e.events)[b].apply(i,arguments):void 0}}(this)}},c.prototype.addEvents=function(){var e;this.removeEvents(),e=this.events,this.options.disableResize||this.win.bind(v,e[v]),this.iOSNativeScrolling||(this.slider.bind(d,e[o]),this.pane.bind(d,e[h]).bind(""+g+" "+a,e[_])),this.$content.bind(""+S+" "+g+" "+a+" "+T,e[S])},c.prototype.removeEvents=function(){var e;e=this.events,this.win.unbind(v,e[v]),this.iOSNativeScrolling||(this.slider.unbind(),this.pane.unbind()),this.$content.unbind(""+S+" "+g+" "+a+" "+T,e[S])},c.prototype.generate=function(){var e,i,a,o,r,s,c;return o=this.options,s=o.paneClass,c=o.sliderClass,e=o.contentClass,(r=this.$el.children("."+s)).length||r.children("."+c).length||this.$el.append('<div class="'+s+'"><div class="'+c+'" /></div>'),this.pane=this.$el.children("."+s),this.slider=this.pane.find("."+c),0===n&&O()?(a=t.getComputedStyle(this.content,null).getPropertyValue("padding-right").replace(/[^0-9.]+/g,""),i={right:-14,paddingRight:+a+14}):n&&(i={right:-n},this.$el.addClass(o.enabledClass)),null!=i&&this.$content.css(i),this},c.prototype.restore=function(){this.stopped=!1,this.iOSNativeScrolling||this.pane.show(),this.addEvents()},c.prototype.reset=function(){var e,t,i,a,o,r,s,c,l,d,u,p;return this.iOSNativeScrolling?void(this.contentHeight=this.content.scrollHeight):(this.$el.find("."+this.options.paneClass).length||this.generate().stop(),this.stopped&&this.restore(),e=this.content,a=e.style,o=a.overflowY,t=e.scrollHeight+n,d=parseInt(this.$el.css("max-height"),10),d>0&&(this.$el.height(""),this.$el.height(e.scrollHeight>d?d:e.scrollHeight)),s=this.pane.outerHeight(!1),l=parseInt(this.pane.css("top"),10),r=parseInt(this.pane.css("bottom"),10),c=s+l+r,p=Math.round(c/t*s),p<this.options.sliderMinHeight?p=this.options.sliderMinHeight:null!=this.options.sliderMaxHeight&&p>this.options.sliderMaxHeight&&(p=this.options.sliderMaxHeight),o===S&&a.overflowX!==S&&(p+=n),this.maxSliderTop=c-p,this.contentHeight=t,this.paneHeight=s,this.paneOuterHeight=c,this.sliderHeight=p,this.paneTop=l,this.slider.height(p),this.events.scroll(),this.pane.show(),this.isActive=!0,e.scrollHeight===e.clientHeight||this.pane.outerHeight(!0)>=e.scrollHeight&&o!==S?(this.pane.hide(),this.isActive=!1):this.el.clientHeight===e.scrollHeight&&o===S?this.slider.hide():this.slider.show(),this.pane.css({opacity:this.options.alwaysVisible?1:"",visibility:this.options.alwaysVisible?"visible":""}),i=this.$content.css("position"),("static"===i||"relative"===i)&&(u=parseInt(this.$content.css("right"),10),u&&this.$content.css({right:"",marginRight:u})),this)},c.prototype.scroll=function(){return this.isActive?(this.sliderY=Math.max(0,this.sliderY),this.sliderY=Math.min(this.maxSliderTop,this.sliderY),this.$content.scrollTop(this.maxScrollTop*this.sliderY/this.maxSliderTop),this.iOSNativeScrolling||(this.updateScrollValues(),this.setOnScrollStyles()),this):void 0},c.prototype.scrollBottom=function(e){return this.isActive?(this.$content.scrollTop(this.contentHeight-this.$content.height()-e).trigger(g),this.stop().restore(),this):void 0},c.prototype.scrollTop=function(e){return this.isActive?(this.$content.scrollTop(+e).trigger(g),this.stop().restore(),this):void 0},c.prototype.scrollTo=function(e){return this.isActive?(this.scrollTop(this.$el.find(e).get(0).offsetTop),this):void 0},c.prototype.stop=function(){return w&&this.scrollRAF&&(w(this.scrollRAF),this.scrollRAF=null),this.stopped=!0,this.removeEvents(),this.iOSNativeScrolling||this.pane.hide(),this},c.prototype.destroy=function(){return this.stopped||this.stop(),!this.iOSNativeScrolling&&this.pane.length&&this.pane.remove(),this.$content.removeAttr("tabindex"),this.$el.hasClass(this.options.enabledClass)&&(this.$el.removeClass(this.options.enabledClass),this.$content.css({right:""})),this},c.prototype.flash=function(){return!this.iOSNativeScrolling&&this.isActive?(this.reset(),this.pane.addClass(this.options.flashedClass),setTimeout(function(e){return function(){e.pane.removeClass(e.options.flashedClass)}}(this),this.options.flashDelay),this):void 0},c}(),e.fn.nanoScroller=function(t){return this.each(function(){var i,n;if((n=this.nanoscroller)||(i=e.extend({},E,t),this.nanoscroller=n=new m(this,i)),t&&"object"===("undefined"==typeof t?"undefined":ke(t))){if(e.extend(n.options,t),null!=t.scrollBottom)return n.scrollBottom(t.scrollBottom);if(null!=t.scrollTop)return n.scrollTop(t.scrollTop);if(t.scrollTo)return n.scrollTo(t.scrollTo);if("bottom"===t.scroll)return n.scrollBottom(0);if("top"===t.scroll)return n.scrollTop(0);if(t.scroll&&t.scroll instanceof e)return n.scrollTo(t.scroll);if(t.stop)return n.stop();if(t.destroy)return n.destroy();if(t.flash)return n.flash()}return n.reset()})},e.fn.nanoScroller.Constructor=m}(jQuery,window,document);var Tt={get:X,set:Z},bt=function(){function e(){var e,i=Oe.faceList.find("ul"),n={sum:140,listWidth:Ee.win.innerWidth-20,rowSum:7};if(0==i.children().length){for(var a=0;a<n.sum;a++)e=$('<li title="'+Je.humen[a]+'" data-index="['+Je.humen[a]+']"></li>'),i.append(e);$(".nano").nanoScroller(),t()}}function t(){Oe.faceList.on("click","li",function(e){var t=$(e.currentTarget),i=t.data("index"),n=i.length,a=Oe.chatPostArea.val(),o=a.length,r=Tt.get(Oe.chatPostArea[0]);Oe.faceList.trigger("hide"),a=o?a.substring(0,r)+i+a.substr(r,o):i,Oe.chatPostArea.val(a),r+=n,Tt.set(Oe.chatPostArea[0],r)})}return{render:e}}(),_t=function(e){for(var t,i=new DataView(e),n=2,a=i.byteLength;a>n;){if(t=i.getUint8(n+1),225==t){var o,r=n+10;if(18761==i.getUint16(r))o=!1;else{if(19789!=i.getUint16(r))return!1;o=!0}if(42!=i.getUint16(r+2,!o))return!1;var s=i.getUint32(r+4,!o);if(8>s)return!1;var c,l,d=r+s,u=i.getUint16(d,!o);for(l=0;u>l;l++)if(c=d+12*l+2,274==i.getUint16(c,!o))return parseInt(i.getUint16(c+8,!o),10);return!1}n+=2+i.getUint16(n+2)}return null};!function(e){var t,i=e.Uint8Array,n=e.HTMLCanvasElement,a=n&&n.prototype,o=/\s*;\s*base64\s*(?:;|$)/i,r="toDataURL",s=function(e){for(var n,a,o,r=e.length,s=new i(r/4*3|0),c=0,l=0,d=[0,0],u=0,p=0;r--;)a=e.charCodeAt(c++),n=t[a-43],255!==n&&n!==o&&(d[1]=d[0],d[0]=a,p=p<<6|n,u++,4===u&&(s[l++]=p>>>16,61!==d[1]&&(s[l++]=p>>>8),61!==d[0]&&(s[l++]=p),u=0));return s};i&&(t=new i([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),!n||a.toBlob&&a.toBlobHD||(a.toBlob||(a.toBlob=function(e,t){if(t||(t="image/png"),this.mozGetAsFile)return void e(this.mozGetAsFile("canvas",t));if(this.msToBlob&&/^\s*image\/png\s*(?:$|;)/i.test(t))return void e(this.msToBlob());var n,a=Array.prototype.slice.call(arguments,1),c=this[r].apply(this,a),l=c.indexOf(","),d=c.substring(l+1),u=o.test(c.substring(0,l));Blob.fake?(n=new Blob,u?n.encoding="base64":n.encoding="URI",n.data=d,n.size=d.length):i&&(n=u?new Blob([s(d)],{type:t}):new Blob([decodeURIComponent(d)],{type:t})),e(n)}),!a.toBlobHD&&a.toDataURLHD?a.toBlobHD=function(){r="toDataURLHD";var e=this.toBlob();return r="toDataURL",e}:a.toBlobHD=a.toBlob)}(window),oe.prototype.initialize=function(){var e=this,t=this.options.$trigger,i=this.options.triggerEvent||"click",n=this.options.isNeedWifiTip,a=this.options.initializeCallBack;t&&t.off(i).on(i,function(){e[n?"wifiTip":"bindUploadEvent"](),"function"==typeof a?a():""})},oe.prototype.wifiTip=function(){var e;ae()?this.bindUploadEvent():(e=window.sessionStorage.getItem("wifiTip"),e?this.bindUploadEvent():ne("请注意：非wifi网络下发送图片可能会耗费较多流量",function(){window.sessionStorage.setItem("wifiTip","1"),this.bindUploadEvent()},this))},oe.prototype.bindUploadEvent=function(){var e=this,t=this.options.$inputTrigger;t.trigger("click"),t.off("change").on("change",function(i){e.checkImgFilesLen(this.files),t.prop("value","")})},oe.prototype.checkImgFilesLen=function(e){var t=e.length;return t>we.IMG_UPLOAD_OPTS.MAX_SUM?void this.renderSysMsg({type:"overSumLimit"}):void this.checkImgTypeLocal(e)},oe.prototype.checkImgTypeLocal=function(e){for(var t,i={},n=0,a=e.length;a>n;n++){var r=e[n];t=window.URL.createObjectURL(r),i=$.extend(!0,{},{seq:o(we.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),type:r.type,size:r.size,blobUrl:t,content:r}),-1!=$.inArray(r.type,we.IMG_UPLOAD_OPTS.ACCEPT_TYPE)?(this.options.events.preview(i),this.compressImgFiles(i)):this.options.events.preview(i,"notSupport")}},oe.prototype.compressImgFiles=function(e){var t=e.type;switch(t){case"image/jpeg":this.compressJPGImg(e);break;case"image/jpg":this.compressJPGImg(e);break;case"image/png":this.compressPNGImg(e);break;default:this.options.events.replacePlaceholder(e)}},oe.prototype.compressJPGImg=function(e){function t(t){var n,a=new Image,o=document.createElement("canvas"),r=o.getContext("2d");a.src=e.blobUrl,a.onload=function(){if(n={width:a.naturalWidth,height:a.naturalHeight},o.width=n.width,o.height=n.height,t&&1!=t)switch(t){case 2:r.translate(n.width,0),r.scale(-1,1);break;case 3:r.rotate(Math.PI),r.translate(-n.width,-n.height);break;case 4:r.translate(0,n.height),r.scale(1,-1);break;case 5:o.width=n.height,o.height=n.width,r.rotate(Math.PI/2),r.scale(1,-1);break;case 6:o.width=n.height,o.height=n.width,r.rotate(90*Math.PI/180),r.translate(0,-n.height);break;case 7:o.width=n.height,o.height=n.width,r.rotate(Math.PI/2),r.translate(n.width,-n.height),r.scale(-1,1);break;case 8:o.width=n.height,o.height=n.width,r.rotate(3*Math.PI/2),r.translate(-n.width,0)}r.drawImage(a,0,0);o.toBlob(function(t){e.content=t,e.size=t.size,i.options.events.replacePlaceholder(e)},e.type,we.IMG_UPLOAD_OPTS.JPG_COMPRESS_RATIO/100)}}var i=this,n=new FileReader;n.onload=function(e){var i=_t(e.target.result);t(i)},n.readAsArrayBuffer(e.content)},oe.prototype.compressPNGImg=function(e){var t,i,n,a=this,o=new Image,r=document.createElement("canvas"),s=r.getContext("2d");o.src=e.blobUrl,o.onload=function(){if(t={width:o.naturalWidth,height:o.naturalHeight},!(t.width>we.IMG_UPLOAD_OPTS.MAX_WIDTH||t.height>we.IMG_UPLOAD_OPTS.MAX_HEIGHT))return void a.options.events.replacePlaceholder(e);i=Math.floor(t.width*(we.IMG_UPLOAD_OPTS.MAX_HEIGHT/t.height)),n=Math.floor(t.height*(we.IMG_UPLOAD_OPTS.MAX_WIDTH/t.width)),i>we.IMG_UPLOAD_OPTS.MAX_WIDTH?i=we.IMG_UPLOAD_OPTS.MAX_WIDTH:n>we.IMG_UPLOAD_OPTS.MAX_HEIGHT&&(n=we.IMG_UPLOAD_OPTS.MAX_HEIGHT),r.width=i,r.height=n,s.drawImage(o,0,0,t.width,t.height,0,0,i,n);r.toBlob(function(t){e.content=t,e.size=t.size,a.options.events.replacePlaceholder(e)},e.type)}};var wt=function(e){var t,i={},n=!0;i.len=function(e){var t=e.length;0==t?n=!1:t>=we.MAX_POST_LIMIT.LENGTH&&(p({text:we.MAX_POST_LIMIT.TIP_TEXT},1e3),n=!1)};for(t in i)i[t](e);return n},Et=function(){var e,t=0,i=0;try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),e&&(t=1,i=e.GetVariable("$version").match(/\d+/g))}catch(n){BJ_REPORT&&BJ_REPORT.report("getIEFlashVersion fail")}return{hasFlash:t,flashVersion:parseFloat(i[0]+"."+i[1],10)}},Ct=be();Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var i,n;if(null==this)throw new TypeError(" this is null or not defined");var a=Object(this),o=a.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(i=t),n=0;o>n;){var r;n in a&&(r=a[n],e.call(i,r,n,a)),n++}});var It=function(){function e(){var e,n="kf"+i.kfUin,a=JSON.parse(Ge.get(n)),o=Ee.seqs.data.length;a&&a.forEach(function(n){n.visitorId==i.visitorId&&n.total>o&&(e=n.total-o,t(e))})}function t(e){var t,a,o=i.kfUin,r=i.visitorId,s=[];Ee.seqs.data=JSON.parse(Ge.get(Ee.seqs.key)),s=Ee.seqs.data.slice(0-e);for(var c=0;c<s.length;c++)t="kf"+o+"vId"+r+"index"+s[c],a=JSON.parse(Ge.get(t)),lt.historyMsg.renderSigle(a,"down"),n()}var i=Ee.receptionist;Ee.ioLinkStatus,Ee.chatSocket;return{start:e}}(),Ot=C();Ot.isPageVisibilitySupport&&Ot.visibilitychange(function(e,t,i){var n,a=Ee.receptionist,o=Ee.ioLinkStatus,r=Ee.chatSocket;if(0==t&&"visible"==i){if(Ee.isInIframe){var s,c,l,d="kf"+a.kfUin+"vId"+a.visitorId+"red",u=JSON.parse(Ge.get(d));u&&u.forEach(function(e){for(s in e)l=e[s],c=s.replace("wId",""),l.number>0&&(Ee.isMobile?De.send({visitorid:a.visitorId,kfuin:a.kfUin,wpaId:c,act:"UNREAD",data:{number:l.number}}):et.render("update",l.number))})}n="show",Ee.isRegOK&&It.start(n),r.ioLink&&r.ioLink.disconnected&&o&&-1==o.indexOf("over")&&(Ee.ioLinkStatus="over")}else n="hide";Ee.pageStatus=n}),function(e){var t=function(e,i){var n=/[^\w\-\.:]/.test(e)?new Function(t.arg+",tmpl","var _e=tmpl.encode"+t.helper+",_s='"+e.replace(t.regexp,t.func)+"';return _s;"):t.cache[e]=t.cache[e]||e;return i?n(i,t):function(e){return n(e,t)}};t.cache={},t.load=function(e){return document.getElementById(e).innerHTML},t.regexp=/([\s'\\])(?!(?:[^<]|\<(?!%))*%\>)|(?:\<%(=|#)([\s\S]+?)%\>)|(\<%)|(%\>)/g,t.func=function(e,t,i,n,a,o){return t?{"\n":"\\n","\r":"\\r","	":"\\t"," ":" "}[t]||"\\"+t:i?"="===i?"'+_e("+n+")+'":"'+("+n+"==null?'':"+n+")+'":a?"';":o?"_s+='":void 0},t.encReg=/[<>&"'\x00]/g,t.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"},t.encode=function(e){return(null==e?"":""+e).replace(t.encReg,function(e){return t.encMap[e]||""})},t.joinTpl=function(e,t,i){return e.replace(t,i)},t.arg="o",t.helper=",print=function(s,e){_s+=e?(s==null?'':s):_e(s);},include=function(s,d){_s+=tmpl(s,d);}",e.tmpl=t}($);var kt=(function(){var e,t=window.performance||window.webkitPerformance||window.msPerformance;t&&$(window).load(function(){e=t.timing,Ee.pageLoadStartTime=e.navigationStart,setTimeout(function(){ze({type:1,requestConsumTime:e.loadEventEnd-e.navigationStart,addon:JSON.stringify({domLoad:e.domContentLoadedEventEnd-e.navigationStart})})},20)})}(),new fe);kt.start()}();